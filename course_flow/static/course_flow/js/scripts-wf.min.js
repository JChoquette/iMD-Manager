var workflow=function(t){"use strict";var e,n,i,s,r,o={},l=[],u=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function a(t,e){for(var n in e)t[n]=e[n];return t}function _(t){var e=t.parentNode;e&&e.removeChild(t)}function d(t,e,n){var i,s,r,o=arguments,l={};for(r in e)"key"==r?i=e[r]:"ref"==r?s=e[r]:l[r]=e[r];if(arguments.length>3)for(n=[n],r=3;r<arguments.length;r++)n.push(o[r]);if(null!=n&&(l.children=n),"function"==typeof t&&null!=t.defaultProps)for(r in t.defaultProps)void 0===l[r]&&(l[r]=t.defaultProps[r]);return c(t,l,i,s,null)}function c(t,n,i,s,r){var o={type:t,props:n,key:i,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:r};return null==r&&(o.__v=o),null!=e.vnode&&e.vnode(o),o}function p(t){return t.children}function h(t,e){this.props=t,this.context=e}function f(t,e){if(null==e)return t.__?f(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?f(t):null}function y(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return y(t)}}function v(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!m.__r++||s!==e.debounceRendering)&&((s=e.debounceRendering)||i)(m)}function m(){for(var t;m.__r=n.length;)t=n.sort((function(t,e){return t.__v.__b-e.__v.__b})),n=[],t.some((function(t){var e,n,i,s,r,o,l;t.__d&&(o=(r=(e=t).__v).__e,(l=e.__P)&&(n=[],(i=a({},r)).__v=i,s=C(l,r,i,e.__n,void 0!==l.ownerSVGElement,null,n,null==o?f(r):o),N(n,r),s!=o&&y(r)))}))}function k(t,e,n,i,s,r,u,a,d,h){var y,v,m,k,g,w,x,S=i&&i.__k||l,N=S.length;for(d==o&&(d=null!=u?u[0]:N?f(i,0):null),n.__k=[],y=0;y<e.length;y++)if(null!=(k=n.__k[y]=null==(k=e[y])||"boolean"==typeof k?null:"string"==typeof k||"number"==typeof k?c(null,k,null,null,k):Array.isArray(k)?c(p,{children:k},null,null,null):null!=k.__e||null!=k.__c?c(k.type,k.props,k.key,null,k.__v):k)){if(k.__=n,k.__b=n.__b+1,null===(m=S[y])||m&&k.key==m.key&&k.type===m.type)S[y]=void 0;else for(v=0;v<N;v++){if((m=S[v])&&k.key==m.key&&k.type===m.type){S[v]=void 0;break}m=null}g=C(t,k,m=m||o,s,r,u,a,d,h),(v=k.ref)&&m.ref!=v&&(x||(x=[]),m.ref&&x.push(m.ref,null,k),x.push(v,k.__c||g,k)),null!=g?(null==w&&(w=g),d=b(t,k,m,S,u,g,d),h||"option"!=n.type?"function"==typeof n.type&&(n.__d=d):t.value=""):d&&m.__e==d&&d.parentNode!=t&&(d=f(m))}if(n.__e=w,null!=u&&"function"!=typeof n.type)for(y=u.length;y--;)null!=u[y]&&_(u[y]);for(y=N;y--;)null!=S[y]&&j(S[y],S[y]);if(x)for(y=0;y<x.length;y++)T(x[y],x[++y],x[++y])}function b(t,e,n,i,s,r,o){var l,u,a;if(void 0!==e.__d)l=e.__d,e.__d=void 0;else if(s==n||r!=o||null==r.parentNode)t:if(null==o||o.parentNode!==t)t.appendChild(r),l=null;else{for(u=o,a=0;(u=u.nextSibling)&&a<i.length;a+=2)if(u==r)break t;t.insertBefore(r,o),l=o}return void 0!==l?l:r.nextSibling}function g(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||u.test(e)?n:n+"px"}function w(t,e,n,i,s){var r,o;if(s&&"className"==e&&(e="class"),"style"===e)if("string"==typeof n)t.style=n;else{if("string"==typeof i&&(t.style=i=""),i)for(e in i)n&&e in n||g(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||g(t.style,e,n[e])}else"o"===e[0]&&"n"===e[1]?(r=e!==(e=e.replace(/Capture$/,"")),(o=e.toLowerCase())in t&&(e=o),e=e.slice(2),t.l||(t.l={}),t.l[e]=n,n?i||t.addEventListener(e,x,r):t.removeEventListener(e,x,r)):"list"!==e&&"tagName"!==e&&"form"!==e&&"type"!==e&&"size"!==e&&"download"!==e&&"href"!==e&&!s&&e in t?t[e]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==e&&(e!==(e=e.replace(/xlink:?/,""))?null==n||!1===n?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(e)?t.removeAttribute(e):t.setAttribute(e,n))}function x(t){this.l[t.type](e.event?e.event(t):t)}function S(t,e,n){var i,s;for(i=0;i<t.__k.length;i++)(s=t.__k[i])&&(s.__=t,s.__e&&("function"==typeof s.type&&s.__k.length>1&&S(s,e,n),e=b(n,s,s,t.__k,null,s.__e,e),"function"==typeof t.type&&(t.__d=e)))}function C(t,n,i,s,r,o,l,u,_){var d,c,f,y,v,m,b,g,w,x,C,N=n.type;if(void 0!==n.constructor)return null;(d=e.__b)&&d(n);try{t:if("function"==typeof N){if(g=n.props,w=(d=N.contextType)&&s[d.__c],x=d?w?w.props.value:d.__:s,i.__c?b=(c=n.__c=i.__c).__=c.__E:("prototype"in N&&N.prototype.render?n.__c=c=new N(g,x):(n.__c=c=new h(g,x),c.constructor=N,c.render=I),w&&w.sub(c),c.props=g,c.state||(c.state={}),c.context=x,c.__n=s,f=c.__d=!0,c.__h=[]),null==c.__s&&(c.__s=c.state),null!=N.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=a({},c.__s)),a(c.__s,N.getDerivedStateFromProps(g,c.__s))),y=c.props,v=c.state,f)null==N.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(null==N.getDerivedStateFromProps&&g!==y&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(g,x),!c.__e&&null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(g,c.__s,x)||n.__v===i.__v){c.props=g,c.state=c.__s,n.__v!==i.__v&&(c.__d=!1),c.__v=n,n.__e=i.__e,n.__k=i.__k,c.__h.length&&l.push(c),S(n,u,t);break t}null!=c.componentWillUpdate&&c.componentWillUpdate(g,c.__s,x),null!=c.componentDidUpdate&&c.__h.push((function(){c.componentDidUpdate(y,v,m)}))}c.context=x,c.props=g,c.state=c.__s,(d=e.__r)&&d(n),c.__d=!1,c.__v=n,c.__P=t,d=c.render(c.props,c.state,c.context),c.state=c.__s,null!=c.getChildContext&&(s=a(a({},s),c.getChildContext())),f||null==c.getSnapshotBeforeUpdate||(m=c.getSnapshotBeforeUpdate(y,v)),C=null!=d&&d.type==p&&null==d.key?d.props.children:d,k(t,Array.isArray(C)?C:[C],n,i,s,r,o,l,u,_),c.base=n.__e,c.__h.length&&l.push(c),b&&(c.__E=c.__=null),c.__e=!1}else null==o&&n.__v===i.__v?(n.__k=i.__k,n.__e=i.__e):n.__e=D(i.__e,n,i,s,r,o,l,_);(d=e.diffed)&&d(n)}catch(t){n.__v=null,e.__e(t,n,i)}return n.__e}function N(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function D(t,e,n,i,s,r,u,a){var _,d,c,p,h,f=n.props,y=e.props;if(s="svg"===e.type||s,null!=r)for(_=0;_<r.length;_++)if(null!=(d=r[_])&&((null===e.type?3===d.nodeType:d.localName===e.type)||t==d)){t=d,r[_]=null;break}if(null==t){if(null===e.type)return document.createTextNode(y);t=s?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type,y.is&&{is:y.is}),r=null,a=!1}if(null===e.type)f!==y&&t.data!==y&&(t.data=y);else{if(null!=r&&(r=l.slice.call(t.childNodes)),c=(f=n.props||o).dangerouslySetInnerHTML,p=y.dangerouslySetInnerHTML,!a){if(null!=r)for(f={},h=0;h<t.attributes.length;h++)f[t.attributes[h].name]=t.attributes[h].value;(p||c)&&(p&&c&&p.__html==c.__html||(t.innerHTML=p&&p.__html||""))}(function(t,e,n,i,s){var r;for(r in n)"children"===r||"key"===r||r in e||w(t,r,null,n[r],i);for(r in e)s&&"function"!=typeof e[r]||"children"===r||"key"===r||"value"===r||"checked"===r||n[r]===e[r]||w(t,r,e[r],n[r],i)})(t,y,f,s,a),p?e.__k=[]:(_=e.props.children,k(t,Array.isArray(_)?_:[_],e,n,i,"foreignObject"!==e.type&&s,r,u,o,a)),a||("value"in y&&void 0!==(_=y.value)&&_!==t.value&&w(t,"value",_,f.value,!1),"checked"in y&&void 0!==(_=y.checked)&&_!==t.checked&&w(t,"checked",_,f.checked,!1))}return t}function T(t,n,i){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,i)}}function j(t,n,i){var s,r,o;if(e.unmount&&e.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||T(s,null,n)),i||"function"==typeof t.type||(i=null!=(r=t.__e)),t.__e=t.__d=void 0,null!=(s=t.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(t){e.__e(t,n)}s.base=s.__P=null}if(s=t.__k)for(o=0;o<s.length;o++)s[o]&&j(s[o],n,i);null!=r&&_(r)}function I(t,e,n){return this.constructor(t,n)}e={__e:function(t,e){for(var n,i;e=e.__;)if((n=e.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(i=!0,n.setState(n.constructor.getDerivedStateFromError(t))),null!=n.componentDidCatch&&(i=!0,n.componentDidCatch(t)),i)return v(n.__E=n)}catch(e){t=e}throw t}},h.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=a({},this.state),"function"==typeof t&&(t=t(a({},n),this.props)),t&&a(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),v(this))},h.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),v(this))},h.prototype.render=p,n=[],i="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,m.__r=0,r=o;class O extends h{constructor(t){super(t)}componentDidMount(){this.updateJSON({},this.postMountFunction.bind(this))}updateJSON(t,e){var n=this.setState.bind(this);$.getJSON("/"+this.objectType+"/read/"+this.props.objectID,(function(t){n(t,e)}))}postMountFunction(){}setJSON(t,e){var n={};n[t]=e,this.setState(n,()=>updateValue(this.props.objectID,this.objectType,this.state))}addDeleteSelf(t=this.state.id,e=this.objectType){return d(U,{handleClick:deleteSelf.bind(this,t,e,this.props.updateParent)})}addInsertSibling(t=this.state.id,e=this.props.parentID,n=this.objectType){return d(A,{handleClick:insertSibling.bind(this,t,n,e,this.props.updateParent)})}makeSortable(t,e,n,i,s,r=!1,o=""){t.sortable({revert:100,containment:".workflow-container",axis:r,cursor:"move",cursorAt:{left:10,top:50},connectWith:o,start:()=>{$(i).addClass("dragging"),t.sortable("refresh")},stop:(t,r)=>{$(i).removeClass("dragging"),$("#container").animate({scrollTop:$(r.item[0]).offset().top-200},20),insertedAt(r.item[0].id,n,e,$(r.item[0]).index(),r.item[0].parentElement.id,()=>$(i).trigger(s))}})}}function P(t){return d("p",null,t.text)}class J extends h{constructor(t){super(t),this.updateText=this.updateText.bind(this)}render(){var t=this.props.text;return null!=this.props.text&&""!=this.props.text||null==this.props.defaultText||(t=this.props.defaultText),this.text=t,d("input",{value:t,onBlur:this.updateText})}updateText(t){var e=t.target.value;e!=this.text&&(""==e&&(e=null),this.props.textUpdated(t.target.value))}}class U extends h{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return d("button",{class:"delete-self-button",onClick:this.handleClick},"x")}handleClick(t){this.props.handleClick(t)}}class A extends h{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return d("button",{class:"insert-sibling-button",onClick:this.handleClick},"+")}handleClick(t){this.props.handleClick(t)}}class M extends O{constructor(t){super(t),this.objectType="node"}render(){if(this.state.id)return d("div",{class:"node"},d(J,{text:this.state.title,defaultText:"New Node",textUpdated:this.setJSON.bind(this,"title")}),d(J,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}))}}class E extends O{constructor(t){super(t),this.objectType="nodestrategy",this.maindiv={current:null}}render(){if(this.state.id)return d("div",{class:"node-strategy",id:this.state.id,ref:this.maindiv},d(M,{objectID:this.state.node}))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).on("refresh-node-strategies",this.updateJSON.bind(this))}}class F extends O{constructor(t){super(t),this.objectType="strategy",this.maindiv={current:null}}render(){if(this.state.id){var t=this.state.nodestrategy_set.map(t=>d(E,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return d("div",{class:"strategy"},d(J,{text:this.state.title,defaultText:this.state.strategy_type_display+" "+(this.props.rank+1),textUpdated:this.setJSON.bind(this,"title")}),d(J,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),d("button",{onClick:()=>newNode(this.state.id,this.updateJSON.bind(this))},"Add A Node"),d("div",{class:"node-block",id:this.props.objectID+"-node-block",ref:this.maindiv},t))}}postMountFunction(){this.makeSortable($(this.maindiv.current),this.props.objectID,"nodestrategy",".node-strategy","refresh-node-strategies","y",".node-block")}}class W extends O{constructor(t){super(t),this.objectType="column"}render(){if(this.state.id){var t=this.state.title;return t||(t=this.state.column_type_display),d("div",{class:"column"},t)}}}class V extends O{constructor(t){super(t),this.objectType="columnworkflow",this.maindiv={current:null}}render(){if(this.state.id)return d("div",{class:"column-workflow",id:this.state.id,ref:this.maindiv},d(W,{objectID:this.state.column}),this.addDeleteSelf(this.state.column,"column"))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).on("refresh-column-workflows",this.updateJSON.bind(this))}}class L extends O{constructor(t){super(t),this.objectType="strategyworkflow",this.maindiv={current:null}}render(){if(this.state.id)return d("div",{class:"strategy-workflow",id:this.state.id,ref:this.maindiv},d(F,{objectID:this.state.strategy,rank:this.state.rank}),this.addDeleteSelf(this.state.strategy,"strategy"),this.addInsertSibling())}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).on("refresh-strategy-workflows",this.updateJSON.bind(this))}}class B extends O{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>d(V,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)})),e=this.state.strategyworkflow_set.map(t=>d(L,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return d("div",{id:"workflow-wrapper",class:"workflow-wrapper"},d("div",{class:"workflow-container"},d(J,{text:this.state.title,textUpdated:this.setJSON.bind(this,"title")}),d(P,{text:"Created by "+this.state.author}),d(J,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),d("button",{onClick:()=>newColumn(this.state.id,0,this.updateJSON.bind(this))},"Add A Column"),d("div",{class:"column-row"},t),d("div",{class:"strategy-block"},e)))}}postMountFunction(){this.makeSortable($(".strategy-block"),this.props.objectID,"strategyworkflow",".strategy-workflow","refresh-strategy-workflows","y"),this.makeSortable($(".column-row"),this.props.objectID,"columnworkflow",".column-workflow","refresh-column-workflows","x")}}return t.ClickEditText=J,t.ColumnView=W,t.ColumnWorkflowView=V,t.ComponentJSON=O,t.DeleteSelfButton=U,t.InsertSiblingButton=A,t.NodeStrategyView=E,t.NodeView=M,t.StrategyView=F,t.StrategyWorkflowView=L,t.Text=P,t.WorkflowView=B,t.renderWorkflowView=function(t,n){!function(t,n,i){var s,u,a;e.__&&e.__(t,n),u=(s=i===r)?null:i&&i.__k||n.__k,t=d(p,null,[t]),a=[],C(n,(s?n:i||n).__k=t,u||o,o,void 0!==n.ownerSVGElement,i&&!s?[i]:u?null:n.childNodes.length?l.slice.call(n.childNodes):null,a,i||o,s),N(a,t)}(d(B,{objectID:t.id,type:t.type}),n)},t}({});
