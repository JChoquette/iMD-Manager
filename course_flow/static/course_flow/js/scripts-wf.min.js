var workflow=function(t){"use strict";var e,n,o,i,r,s={},l=[],a=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(t,e){for(var n in e)t[n]=e[n];return t}function d(t){var e=t.parentNode;e&&e.removeChild(t)}function u(t,e,n){var o,i,r,s=arguments,l={};for(r in e)"key"==r?o=e[r]:"ref"==r?i=e[r]:l[r]=e[r];if(arguments.length>3)for(n=[n],r=3;r<arguments.length;r++)n.push(s[r]);if(null!=n&&(l.children=n),"function"==typeof t&&null!=t.defaultProps)for(r in t.defaultProps)void 0===l[r]&&(l[r]=t.defaultProps[r]);return p(t,l,o,i,null)}function p(t,n,o,i,r){var s={type:t,props:n,key:o,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:r};return null==r&&(s.__v=s),null!=e.vnode&&e.vnode(s),s}function _(t){return t.children}function h(t,e){this.props=t,this.context=e}function f(t,e){if(null==e)return t.__?f(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?f(t):null}function m(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return m(t)}}function v(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!y.__r++||i!==e.debounceRendering)&&((i=e.debounceRendering)||o)(y)}function y(){for(var t;y.__r=n.length;)t=n.sort((function(t,e){return t.__v.__b-e.__v.__b})),n=[],t.some((function(t){var e,n,o,i,r,s,l;t.__d&&(s=(r=(e=t).__v).__e,(l=e.__P)&&(n=[],(o=c({},r)).__v=o,i=C(l,r,o,e.__n,void 0!==l.ownerSVGElement,null,n,null==s?f(r):s),D(n,r),i!=s&&m(r)))}))}function k(t,e,n,o,i,r,a,c,u,h){var m,v,y,k,w,g,x,S=o&&o.__k||l,D=S.length;for(u==s&&(u=null!=a?a[0]:D?f(o,0):null),n.__k=[],m=0;m<e.length;m++)if(null!=(k=n.__k[m]=null==(k=e[m])||"boolean"==typeof k?null:"string"==typeof k||"number"==typeof k?p(null,k,null,null,k):Array.isArray(k)?p(_,{children:k},null,null,null):null!=k.__e||null!=k.__c?p(k.type,k.props,k.key,null,k.__v):k)){if(k.__=n,k.__b=n.__b+1,null===(y=S[m])||y&&k.key==y.key&&k.type===y.type)S[m]=void 0;else for(v=0;v<D;v++){if((y=S[v])&&k.key==y.key&&k.type===y.type){S[v]=void 0;break}y=null}w=C(t,k,y=y||s,i,r,a,c,u,h),(v=k.ref)&&y.ref!=v&&(x||(x=[]),y.ref&&x.push(y.ref,null,k),x.push(v,k.__c||w,k)),null!=w?(null==g&&(g=w),u=b(t,k,y,S,a,w,u),h||"option"!=n.type?"function"==typeof n.type&&(n.__d=u):t.value=""):u&&y.__e==u&&u.parentNode!=t&&(u=f(y))}if(n.__e=g,null!=a&&"function"!=typeof n.type)for(m=a.length;m--;)null!=a[m]&&d(a[m]);for(m=D;m--;)null!=S[m]&&j(S[m],S[m]);if(x)for(m=0;m<x.length;m++)I(x[m],x[++m],x[++m])}function b(t,e,n,o,i,r,s){var l,a,c;if(void 0!==e.__d)l=e.__d,e.__d=void 0;else if(i==n||r!=s||null==r.parentNode)t:if(null==s||s.parentNode!==t)t.appendChild(r),l=null;else{for(a=s,c=0;(a=a.nextSibling)&&c<o.length;c+=2)if(a==r)break t;t.insertBefore(r,s),l=s}return void 0!==l?l:r.nextSibling}function w(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||a.test(e)?n:n+"px"}function g(t,e,n,o,i){var r,s;if(i&&"className"==e&&(e="class"),"style"===e)if("string"==typeof n)t.style=n;else{if("string"==typeof o&&(t.style=o=""),o)for(e in o)n&&e in n||w(t.style,e,"");if(n)for(e in n)o&&n[e]===o[e]||w(t.style,e,n[e])}else"o"===e[0]&&"n"===e[1]?(r=e!==(e=e.replace(/Capture$/,"")),(s=e.toLowerCase())in t&&(e=s),e=e.slice(2),t.l||(t.l={}),t.l[e]=n,n?o||t.addEventListener(e,x,r):t.removeEventListener(e,x,r)):"list"!==e&&"tagName"!==e&&"form"!==e&&"type"!==e&&"size"!==e&&"download"!==e&&"href"!==e&&!i&&e in t?t[e]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==e&&(e!==(e=e.replace(/xlink:?/,""))?null==n||!1===n?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(e)?t.removeAttribute(e):t.setAttribute(e,n))}function x(t){this.l[t.type](e.event?e.event(t):t)}function S(t,e,n){var o,i;for(o=0;o<t.__k.length;o++)(i=t.__k[o])&&(i.__=t,i.__e&&("function"==typeof i.type&&i.__k.length>1&&S(i,e,n),e=b(n,i,i,t.__k,null,i.__e,e),"function"==typeof t.type&&(t.__d=e)))}function C(t,n,o,i,r,s,l,a,d){var u,p,f,m,v,y,b,w,g,x,C,D=n.type;if(void 0!==n.constructor)return null;(u=e.__b)&&u(n);try{t:if("function"==typeof D){if(w=n.props,g=(u=D.contextType)&&i[u.__c],x=u?g?g.props.value:u.__:i,o.__c?b=(p=n.__c=o.__c).__=p.__E:("prototype"in D&&D.prototype.render?n.__c=p=new D(w,x):(n.__c=p=new h(w,x),p.constructor=D,p.render=T),g&&g.sub(p),p.props=w,p.state||(p.state={}),p.context=x,p.__n=i,f=p.__d=!0,p.__h=[]),null==p.__s&&(p.__s=p.state),null!=D.getDerivedStateFromProps&&(p.__s==p.state&&(p.__s=c({},p.__s)),c(p.__s,D.getDerivedStateFromProps(w,p.__s))),m=p.props,v=p.state,f)null==D.getDerivedStateFromProps&&null!=p.componentWillMount&&p.componentWillMount(),null!=p.componentDidMount&&p.__h.push(p.componentDidMount);else{if(null==D.getDerivedStateFromProps&&w!==m&&null!=p.componentWillReceiveProps&&p.componentWillReceiveProps(w,x),!p.__e&&null!=p.shouldComponentUpdate&&!1===p.shouldComponentUpdate(w,p.__s,x)||n.__v===o.__v){p.props=w,p.state=p.__s,n.__v!==o.__v&&(p.__d=!1),p.__v=n,n.__e=o.__e,n.__k=o.__k,p.__h.length&&l.push(p),S(n,a,t);break t}null!=p.componentWillUpdate&&p.componentWillUpdate(w,p.__s,x),null!=p.componentDidUpdate&&p.__h.push((function(){p.componentDidUpdate(m,v,y)}))}p.context=x,p.props=w,p.state=p.__s,(u=e.__r)&&u(n),p.__d=!1,p.__v=n,p.__P=t,u=p.render(p.props,p.state,p.context),p.state=p.__s,null!=p.getChildContext&&(i=c(c({},i),p.getChildContext())),f||null==p.getSnapshotBeforeUpdate||(y=p.getSnapshotBeforeUpdate(m,v)),C=null!=u&&u.type==_&&null==u.key?u.props.children:u,k(t,Array.isArray(C)?C:[C],n,o,i,r,s,l,a,d),p.base=n.__e,p.__h.length&&l.push(p),b&&(p.__E=p.__=null),p.__e=!1}else null==s&&n.__v===o.__v?(n.__k=o.__k,n.__e=o.__e):n.__e=N(o.__e,n,o,i,r,s,l,d);(u=e.diffed)&&u(n)}catch(t){n.__v=null,e.__e(t,n,o)}return n.__e}function D(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function N(t,e,n,o,i,r,a,c){var d,u,p,_,h,f=n.props,m=e.props;if(i="svg"===e.type||i,null!=r)for(d=0;d<r.length;d++)if(null!=(u=r[d])&&((null===e.type?3===u.nodeType:u.localName===e.type)||t==u)){t=u,r[d]=null;break}if(null==t){if(null===e.type)return document.createTextNode(m);t=i?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type,m.is&&{is:m.is}),r=null,c=!1}if(null===e.type)f!==m&&t.data!==m&&(t.data=m);else{if(null!=r&&(r=l.slice.call(t.childNodes)),p=(f=n.props||s).dangerouslySetInnerHTML,_=m.dangerouslySetInnerHTML,!c){if(null!=r)for(f={},h=0;h<t.attributes.length;h++)f[t.attributes[h].name]=t.attributes[h].value;(_||p)&&(_&&p&&_.__html==p.__html||(t.innerHTML=_&&_.__html||""))}(function(t,e,n,o,i){var r;for(r in n)"children"===r||"key"===r||r in e||g(t,r,null,n[r],o);for(r in e)i&&"function"!=typeof e[r]||"children"===r||"key"===r||"value"===r||"checked"===r||n[r]===e[r]||g(t,r,e[r],n[r],o)})(t,m,f,i,c),_?e.__k=[]:(d=e.props.children,k(t,Array.isArray(d)?d:[d],e,n,o,"foreignObject"!==e.type&&i,r,a,s,c)),c||("value"in m&&void 0!==(d=m.value)&&d!==t.value&&g(t,"value",d,f.value,!1),"checked"in m&&void 0!==(d=m.checked)&&d!==t.checked&&g(t,"checked",d,f.checked,!1))}return t}function I(t,n,o){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,o)}}function j(t,n,o){var i,r,s;if(e.unmount&&e.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||I(i,null,n)),o||"function"==typeof t.type||(o=null!=(r=t.__e)),t.__e=t.__d=void 0,null!=(i=t.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(t){e.__e(t,n)}i.base=i.__P=null}if(i=t.__k)for(s=0;s<i.length;s++)i[s]&&j(i[s],n,o);null!=r&&d(r)}function T(t,e,n){return this.constructor(t,n)}function O(t,n,o){var i,a,c;e.__&&e.__(t,n),a=(i=o===r)?null:o&&o.__k||n.__k,t=u(_,null,[t]),c=[],C(n,(i?n:o||n).__k=t,a||s,s,void 0!==n.ownerSVGElement,o&&!i?[o]:a?null:n.childNodes.length?l.slice.call(n.childNodes):null,c,o||s,i),D(c,t)}e={__e:function(t,e){for(var n,o;e=e.__;)if((n=e.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(o=!0,n.setState(n.constructor.getDerivedStateFromError(t))),null!=n.componentDidCatch&&(o=!0,n.componentDidCatch(t)),o)return v(n.__E=n)}catch(e){t=e}throw t}},h.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof t&&(t=t(c({},n),this.props)),t&&c(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),v(this))},h.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),v(this))},h.prototype.render=_,n=[],o="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,y.__r=0,r=s;var P;class A extends h{constructor(t){super(t),this.maindiv={current:null}}componentDidMount(){this.updateJSON({},function(){this.maindiv.current&&(this.maindiv.current.react=this),this.postMountFunction()}.bind(this))}updateJSON(t,e){var n=this.setState.bind(this);try{$.getJSON("/"+this.objectType+"/read/"+this.props.objectID,(function(t){console.log("Fetch returned json:"),console.log(t),n(t,e)}))}catch(t){}}postMountFunction(){}setJSON(t,e){var n={};n[t]=e,this.setState(n,()=>updateValue(this.props.objectID,this.objectType,n))}addDeleteSelf(t=this.state.id,e=this.objectType,n){return u(W,{handleClick:deleteSelf.bind(this,t,e,()=>{this.props.updateParent({},n)})})}addInsertSibling(t=this.state.id,e=this.props.parentID,n=this.objectType,o){return u(J,{handleClick:insertSibling.bind(this,t,n,e,()=>{this.props.updateParent({},o)})})}makeSortable(t,e,n,o,i=!1,r=!1,s="",l=!1){t.sortable({containment:".workflow-container",axis:i,cursor:"move",grid:r,cursorAt:{top:20},connectWith:s,handle:l,tolerance:"pointer",start:(e,n)=>{$(o).addClass("dragging"),t.sortable("refresh");var i=$(t).sortable("instance");if(l){var r=$(i.currentItem).children(l);r=r[0],i.containment[0]-=r.offsetLeft,i.containment[2]+=i.currentItem[0].offsetWidth-r.offsetWidth-r.offsetLeft}i.containment[3]+=i.currentItem[0].offsetTop},remove:(t,e)=>{var o=e.item[0].id;this.childRemoved.bind(this)(n,parseInt(o))},receive:(t,o)=>{console.log("firing receive"),console.log(o),console.log(t);var i=o.item[0].id,r=$(o.item[0]).index();o.item[0].classList.contains("node-bar-sortable")?this.newChild.bind(this)(n,e,r,o):this.childAdded.bind(this)(n,parseInt(i),r)},stop:(t,i)=>{console.log("firing stop");var r=i.item[0].id,s=$(i.item[0]).index(),l=parseInt(i.item[0].parentElement.id);l&&l!=e||this.childAdded.bind(this)(n,parseInt(r),s),$(o).removeClass("dragging"),$("#container").animate({scrollTop:$(i.item[0]).offset().top-200},20);var a=Math.round((i.position.left-i.originalPosition.left)/200),c=-1;if("nodestrategy"==n&&a){var d=i.item.children(".node"),u=d[0].react.state.columnworkflow;try{(c=P[P.indexOf(u)+a])&&d[0].react.setState({columnworkflow:c})}catch(t){console.log("could not change column")}}insertedAt(r,n,e,s,l,c,()=>$(o).trigger(n+"-reordered"))}})}childRemoved(t,e){try{var n=this.state[t+"_set"];n.indexOf(e)>=0&&n.splice(n.indexOf(e),1)}catch(t){}}childAdded(t,e,n){try{var o=this.state[t+"_set"];o.indexOf(e)>=0&&o.splice(o.indexOf(e),1),o.splice(n,0,e)}catch(t){}}newChild(t,e,n,o){console.log(n),console.log(e),"nodestrategy"==t&&newNode(e,n,o.item[0].sortableData.column,this.updateJSON.bind(this)),o.item.remove()}}function M(t){return u("p",null,t.text)}class U extends h{constructor(t){super(t),this.updateText=this.updateText.bind(this)}render(){var t=this.props.text;return null!=this.props.text&&""!=this.props.text||null==this.props.defaultText||(t=this.props.defaultText),this.text=t,u("input",{value:t,onBlur:this.updateText})}updateText(t){var e=t.target.value;e!=this.text&&(""==e&&(e=null),this.props.textUpdated(t.target.value))}}class W extends h{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"delete-self-button",onClick:this.handleClick},"x")}handleClick(t){this.props.handleClick(t)}}class J extends h{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"insert-sibling-button",onClick:this.handleClick},"+")}handleClick(t){this.props.handleClick(t)}}class E extends A{constructor(t){super(t),this.objectType="node"}render(){if(this.state.id)return u("div",{class:"node column-"+this.state.columnworkflow,ref:this.maindiv},u(U,{text:this.state.title,defaultText:"New Node",textUpdated:this.setJSON.bind(this,"title")}),u(U,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}))}}class F extends A{constructor(t){super(t),this.objectType="nodestrategy"}render(){if(this.state.id)return u("div",{class:"node-strategy",id:this.state.id,ref:this.maindiv},u(E,{objectID:this.state.node}))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).on("nodestrategy-reordered",this.updateRank.bind(this))}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}}class V extends A{constructor(t){super(t),this.objectType="strategy"}render(){if(this.state.id){var t=this.state.nodestrategy_set.map(t=>u(F,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{class:"strategy"},u(U,{text:this.state.title,defaultText:this.state.strategy_type_display+" "+(this.props.rank+1),textUpdated:this.setJSON.bind(this,"title")}),u(U,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newNode(this.state.id,-1,P[P.length-1],this.updateJSON.bind(this))},"Add A Node"),u("div",{class:"node-block",id:this.props.objectID+"-node-block",ref:this.maindiv},t))}}postMountFunction(){this.makeSortable($(this.maindiv.current),this.props.objectID,"nodestrategy",".node-strategy",!1,[200,1],".node-block",".node")}}class L extends A{constructor(t){super(t),this.objectType="column"}render(){if(this.state.id){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"column"},t)}}}class R extends A{constructor(t){super(t),this.objectType="columnworkflow",$("<style>").prop("type","text/css").prop("id","column-"+this.props.objectID+"-CSS").appendTo("head")}render(){return this.state.id?(this.updateCSS(),u("div",{class:"column-workflow column-"+this.state.id,id:this.state.id,ref:this.maindiv},u(L,{objectID:this.state.column}),this.addDeleteSelf(this.state.column,"column",()=>$(".column-workflow").trigger("columnworkflow-reordered")))):u("div",{class:"column-workflow column-"+this.state.id})}postMountFunction(){this.maindiv.current&&($(".column-workflow").trigger("columnworkflow-reordered"),$(this.maindiv.current).on("columnworkflow-reordered",this.updateRank.bind(this)))}updateCSS(){$("#column-"+this.props.objectID+"-CSS").html(".column-"+this.props.objectID+"{left:"+this.calcDistance()+"px}")}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}calcDistance(){return 200*this.state.rank}}class B extends A{constructor(t){super(t),this.objectType="strategyworkflow"}render(){if(this.state.id)return u("div",{class:"strategy-workflow",id:this.state.id,ref:this.maindiv},u(V,{objectID:this.state.strategy,rank:this.state.rank}),this.addDeleteSelf(this.state.strategy,"strategy",()=>$(".strategy-workflow").trigger("strategyworkflow-reordered")),this.addInsertSibling(this.state.id,this.props.parentID,"strategyworkflow"))}postMountFunction(){this.maindiv.current&&($(".strategy-workflow").trigger("strategyworkflow-reordered"),$(this.maindiv.current).on("strategyworkflow-reordered",this.updateRank.bind(this)))}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}}class H extends A{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>u(R,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)})),e=this.state.strategyworkflow_set.map(t=>u(B,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{id:"workflow-wrapper",class:"workflow-wrapper"},u("div",{class:"workflow-container"},u(U,{text:this.state.title,textUpdated:this.setJSON.bind(this,"title")}),u(M,{text:"Created by "+this.state.author}),u(U,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newColumn(this.state.id,0,this.updateJSON.bind(this))},"Add A Column"),u("div",{class:"column-row"},t),u("div",{class:"strategy-block"},e)))}}postMountFunction(){this.makeSortable($(".strategy-block"),this.props.objectID,"strategyworkflow",".strategy-workflow","y"),this.makeSortable($(".column-row"),this.props.objectID,"columnworkflow",".column-workflow","x")}componentDidUpdate(){this.state&&(P=this.state.columnworkflow_set)}}class z extends A{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>u(G,{key:t,objectID:t})),e=this.state.strategyworkflow_set.map(t=>u(K,{key:t,objectID:t}));return u("div",{id:"node-bar-workflow",class:"node-bar-workflow",ref:this.maindiv},u("div",{class:"node-bar-column-block"},t),u("div",{class:"node-bar-strategy-block"},e))}}postMountFunction(){$(this.maindiv.current.parentElement).resizable({containment:"body"})}}class G extends A{constructor(t){super(t),this.objectType="columnworkflow"}render(){if(this.state.id)return u("div",{class:"node-bar-column-workflow",ref:this.maindiv},u(q,{objectID:this.state.column}))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).sortable({connectWith:".node-block",helper:(t,e)=>(this.maindiv.current.copyHelper=e.clone().insertAfter(e),e.clone().appendTo(document.body)),containment:".workflow-container",start:(t,e)=>{e.item[0].sortableData={column:this.state.column}},stop:(t,e)=>{e.item[0].parentElement&&e.item[0].parentElement.classList.contains("node-bar-column-workflow")&&e.item.remove()}})}}class q extends A{constructor(t){super(t),this.objectType="column"}render(){if(this.state){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"node-bar-column node-bar-sortable"},t)}}}class K extends A{constructor(t){super(t),this.objectType="strategyworkflow"}render(){}}return t.ClickEditText=U,t.ColumnView=L,t.ColumnWorkflowView=R,t.ComponentJSON=A,t.DeleteSelfButton=W,t.InsertSiblingButton=J,t.NodeBarColumnView=q,t.NodeBarColumnWorkflowView=G,t.NodeBarStrategyWorkflowView=K,t.NodeBarWorkflowView=z,t.NodeStrategyView=F,t.NodeView=E,t.StrategyView=V,t.StrategyWorkflowView=B,t.Text=M,t.WorkflowView=H,t.renderNodeBar=function(t,e){O(u(z,{objectID:t.id,type:t.type}),e)},t.renderWorkflowView=function(t,e){O(u(H,{objectID:t.id,type:t.type}),e)},t}({});
