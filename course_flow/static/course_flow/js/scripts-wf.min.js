var workflow=function(t){"use strict";var e,n,r,o,i,s={},a=[],l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function d(t,e){for(var n in e)t[n]=e[n];return t}function c(t){var e=t.parentNode;e&&e.removeChild(t)}function u(t,e,n){var r,o,i,s=arguments,a={};for(i in e)"key"==i?r=e[i]:"ref"==i?o=e[i]:a[i]=e[i];if(arguments.length>3)for(n=[n],i=3;i<arguments.length;i++)n.push(s[i]);if(null!=n&&(a.children=n),"function"==typeof t&&null!=t.defaultProps)for(i in t.defaultProps)void 0===a[i]&&(a[i]=t.defaultProps[i]);return h(t,a,r,o,null)}function h(t,n,r,o,i){var s={type:t,props:n,key:r,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:i};return null==i&&(s.__v=s),null!=e.vnode&&e.vnode(s),s}function p(t){return t.children}function _(t,e){this.props=t,this.context=e}function f(t,e){if(null==e)return t.__?f(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?f(t):null}function v(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return v(t)}}function g(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!m.__r++||o!==e.debounceRendering)&&((o=e.debounceRendering)||r)(m)}function m(){for(var t;m.__r=n.length;)t=n.sort((function(t,e){return t.__v.__b-e.__v.__b})),n=[],t.some((function(t){var e,n,r,o,i,s,a;t.__d&&(s=(i=(e=t).__v).__e,(a=e.__P)&&(n=[],(r=d({},i)).__v=r,o=N(a,i,r,e.__n,void 0!==a.ownerSVGElement,null,n,null==s?f(i):s),D(n,i),o!=s&&v(i)))}))}function b(t,e,n,r,o,i,l,d,u,_){var v,g,m,b,y,w,S,x=r&&r.__k||a,C=x.length;for(u==s&&(u=null!=l?l[0]:C?f(r,0):null),n.__k=[],v=0;v<e.length;v++)if(null!=(b=n.__k[v]=null==(b=e[v])||"boolean"==typeof b?null:"string"==typeof b||"number"==typeof b?h(null,b,null,null,b):Array.isArray(b)?h(p,{children:b},null,null,null):null!=b.__e||null!=b.__c?h(b.type,b.props,b.key,null,b.__v):b)){if(b.__=n,b.__b=n.__b+1,null===(m=x[v])||m&&b.key==m.key&&b.type===m.type)x[v]=void 0;else for(g=0;g<C;g++){if((m=x[g])&&b.key==m.key&&b.type===m.type){x[g]=void 0;break}m=null}y=N(t,b,m=m||s,o,i,l,d,u,_),(g=b.ref)&&m.ref!=g&&(S||(S=[]),m.ref&&S.push(m.ref,null,b),S.push(g,b.__c||y,b)),null!=y?(null==w&&(w=y),u=k(t,b,m,x,l,y,u),_||"option"!=n.type?"function"==typeof n.type&&(n.__d=u):t.value=""):u&&m.__e==u&&u.parentNode!=t&&(u=f(m))}if(n.__e=w,null!=l&&"function"!=typeof n.type)for(v=l.length;v--;)null!=l[v]&&c(l[v]);for(v=C;v--;)null!=x[v]&&j(x[v],x[v]);if(S)for(v=0;v<S.length;v++)T(S[v],S[++v],S[++v])}function y(t,e){return e=e||[],null==t||"boolean"==typeof t||(Array.isArray(t)?t.some((function(t){y(t,e)})):e.push(t)),e}function k(t,e,n,r,o,i,s){var a,l,d;if(void 0!==e.__d)a=e.__d,e.__d=void 0;else if(o==n||i!=s||null==i.parentNode)t:if(null==s||s.parentNode!==t)t.appendChild(i),a=null;else{for(l=s,d=0;(l=l.nextSibling)&&d<r.length;d+=2)if(l==i)break t;t.insertBefore(i,s),a=s}return void 0!==a?a:i.nextSibling}function w(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||l.test(e)?n:n+"px"}function S(t,e,n,r,o){var i,s;if(o&&"className"==e&&(e="class"),"style"===e)if("string"==typeof n)t.style=n;else{if("string"==typeof r&&(t.style=r=""),r)for(e in r)n&&e in n||w(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||w(t.style,e,n[e])}else"o"===e[0]&&"n"===e[1]?(i=e!==(e=e.replace(/Capture$/,"")),(s=e.toLowerCase())in t&&(e=s),e=e.slice(2),t.l||(t.l={}),t.l[e]=n,n?r||t.addEventListener(e,x,i):t.removeEventListener(e,x,i)):"list"!==e&&"tagName"!==e&&"form"!==e&&"type"!==e&&"size"!==e&&"download"!==e&&"href"!==e&&!o&&e in t?t[e]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==e&&(e!==(e=e.replace(/xlink:?/,""))?null==n||!1===n?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(e)?t.removeAttribute(e):t.setAttribute(e,n))}function x(t){this.l[t.type](e.event?e.event(t):t)}function C(t,e,n){var r,o;for(r=0;r<t.__k.length;r++)(o=t.__k[r])&&(o.__=t,o.__e&&("function"==typeof o.type&&o.__k.length>1&&C(o,e,n),e=k(n,o,o,t.__k,null,o.__e,e),"function"==typeof t.type&&(t.__d=e)))}function N(t,n,r,o,i,s,a,l,c){var u,h,f,v,g,m,y,k,w,S,x,N=n.type;if(void 0!==n.constructor)return null;(u=e.__b)&&u(n);try{t:if("function"==typeof N){if(k=n.props,w=(u=N.contextType)&&o[u.__c],S=u?w?w.props.value:u.__:o,r.__c?y=(h=n.__c=r.__c).__=h.__E:("prototype"in N&&N.prototype.render?n.__c=h=new N(k,S):(n.__c=h=new _(k,S),h.constructor=N,h.render=P),w&&w.sub(h),h.props=k,h.state||(h.state={}),h.context=S,h.__n=o,f=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=N.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=d({},h.__s)),d(h.__s,N.getDerivedStateFromProps(k,h.__s))),v=h.props,g=h.state,f)null==N.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==N.getDerivedStateFromProps&&k!==v&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(k,S),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(k,h.__s,S)||n.__v===r.__v){h.props=k,h.state=h.__s,n.__v!==r.__v&&(h.__d=!1),h.__v=n,n.__e=r.__e,n.__k=r.__k,h.__h.length&&a.push(h),C(n,l,t);break t}null!=h.componentWillUpdate&&h.componentWillUpdate(k,h.__s,S),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(v,g,m)}))}h.context=S,h.props=k,h.state=h.__s,(u=e.__r)&&u(n),h.__d=!1,h.__v=n,h.__P=t,u=h.render(h.props,h.state,h.context),h.state=h.__s,null!=h.getChildContext&&(o=d(d({},o),h.getChildContext())),f||null==h.getSnapshotBeforeUpdate||(m=h.getSnapshotBeforeUpdate(v,g)),x=null!=u&&u.type==p&&null==u.key?u.props.children:u,b(t,Array.isArray(x)?x:[x],n,r,o,i,s,a,l,c),h.base=n.__e,h.__h.length&&a.push(h),y&&(h.__E=h.__=null),h.__e=!1}else null==s&&n.__v===r.__v?(n.__k=r.__k,n.__e=r.__e):n.__e=I(r.__e,n,r,o,i,s,a,c);(u=e.diffed)&&u(n)}catch(t){n.__v=null,e.__e(t,n,r)}return n.__e}function D(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function I(t,e,n,r,o,i,l,d){var c,u,h,p,_,f=n.props,v=e.props;if(o="svg"===e.type||o,null!=i)for(c=0;c<i.length;c++)if(null!=(u=i[c])&&((null===e.type?3===u.nodeType:u.localName===e.type)||t==u)){t=u,i[c]=null;break}if(null==t){if(null===e.type)return document.createTextNode(v);t=o?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type,v.is&&{is:v.is}),i=null,d=!1}if(null===e.type)f!==v&&t.data!==v&&(t.data=v);else{if(null!=i&&(i=a.slice.call(t.childNodes)),h=(f=n.props||s).dangerouslySetInnerHTML,p=v.dangerouslySetInnerHTML,!d){if(null!=i)for(f={},_=0;_<t.attributes.length;_++)f[t.attributes[_].name]=t.attributes[_].value;(p||h)&&(p&&h&&p.__html==h.__html||(t.innerHTML=p&&p.__html||""))}(function(t,e,n,r,o){var i;for(i in n)"children"===i||"key"===i||i in e||S(t,i,null,n[i],r);for(i in e)o&&"function"!=typeof e[i]||"children"===i||"key"===i||"value"===i||"checked"===i||n[i]===e[i]||S(t,i,e[i],n[i],r)})(t,v,f,o,d),p?e.__k=[]:(c=e.props.children,b(t,Array.isArray(c)?c:[c],e,n,r,"foreignObject"!==e.type&&o,i,l,s,d)),d||("value"in v&&void 0!==(c=v.value)&&c!==t.value&&S(t,"value",c,f.value,!1),"checked"in v&&void 0!==(c=v.checked)&&c!==t.checked&&S(t,"checked",c,f.checked,!1))}return t}function T(t,n,r){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,r)}}function j(t,n,r){var o,i,s;if(e.unmount&&e.unmount(t),(o=t.ref)&&(o.current&&o.current!==t.__e||T(o,null,n)),r||"function"==typeof t.type||(r=null!=(i=t.__e)),t.__e=t.__d=void 0,null!=(o=t.__c)){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(t){e.__e(t,n)}o.base=o.__P=null}if(o=t.__k)for(s=0;s<o.length;s++)o[s]&&j(o[s],n,r);null!=i&&c(i)}function P(t,e,n){return this.constructor(t,n)}function E(t,n,r){var o,l,d;e.__&&e.__(t,n),l=(o=r===i)?null:r&&r.__k||n.__k,t=u(p,null,[t]),d=[],N(n,(o?n:r||n).__k=t,l||s,s,void 0!==n.ownerSVGElement,r&&!o?[r]:l?null:n.childNodes.length?a.slice.call(n.childNodes):null,d,r||s,o),D(d,t)}e={__e:function(t,e){for(var n,r;e=e.__;)if((n=e.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(r=!0,n.setState(n.constructor.getDerivedStateFromError(t))),null!=n.componentDidCatch&&(r=!0,n.componentDidCatch(t)),r)return g(n.__E=n)}catch(e){t=e}throw t}},_.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=d({},this.state),"function"==typeof t&&(t=t(d({},n),this.props)),t&&d(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),g(this))},_.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),g(this))},_.prototype.render=p,n=[],r="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,m.__r=0,i=s;var A,O=[],U=e.__r,L=e.diffed,W=e.__c,V=e.unmount;function F(){O.some((function(t){if(t.__P)try{t.__H.__h.forEach(M),t.__H.__h.forEach(J),t.__H.__h=[]}catch(n){return t.__H.__h=[],e.__e(n,t.__v),!0}})),O=[]}e.__r=function(t){U&&U(t),0;var e=t.__c.__H;e&&(e.__h.forEach(M),e.__h.forEach(J),e.__h=[])},e.diffed=function(t){L&&L(t);var n=t.__c;n&&n.__H&&n.__H.__h.length&&(1!==O.push(n)&&A===e.requestAnimationFrame||((A=e.requestAnimationFrame)||function(t){var e,n=function(){clearTimeout(r),H&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);H&&(e=requestAnimationFrame(n))})(F))},e.__c=function(t,n){n.some((function(t){try{t.__h.forEach(M),t.__h=t.__h.filter((function(t){return!t.__||J(t)}))}catch(r){n.some((function(t){t.__h&&(t.__h=[])})),n=[],e.__e(r,t.__v)}})),W&&W(t,n)},e.unmount=function(t){V&&V(t);var n=t.__c;if(n&&n.__H)try{n.__H.__.forEach(M)}catch(t){e.__e(t,n.__v)}};var H="function"==typeof requestAnimationFrame;function M(t){"function"==typeof t.u&&t.u()}function J(t){t.u=t.__()}function R(t,e){for(var n in t)if("__source"!==n&&!(n in e))return!0;for(var r in e)if("__source"!==r&&t[r]!==e[r])return!0;return!1}function B(t){this.props=t}(B.prototype=new _).isPureReactComponent=!0,B.prototype.shouldComponentUpdate=function(t,e){return R(this.props,t)||R(this.state,e)};var G=e.__b;e.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),G&&G(t)};var z=e.__e;function q(t){return t&&((t=function(t,e){for(var n in e)t[n]=e[n];return t}({},t)).__c=null,t.__k=t.__k&&t.__k.map(q)),t}function Z(t){return t&&(t.__v=null,t.__k=t.__k&&t.__k.map(Z)),t}function K(){this.__u=0,this.t=null,this.__b=null}function Q(t){var e=t.__.__c;return e&&e.o&&e.o(t)}function X(){this.u=null,this.i=null}e.__e=function(t,e,n){if(t.then)for(var r,o=e;o=o.__;)if((r=o.__c)&&r.__c)return null==e.__e&&(e.__e=n.__e,e.__k=n.__k),r.__c(t,e.__c);z(t,e,n)},(K.prototype=new _).__c=function(t,e){var n=this;null==n.t&&(n.t=[]),n.t.push(e);var r=Q(n.__v),o=!1,i=function(){o||(o=!0,e.componentWillUnmount=e.__c,r?r(s):s())};e.__c=e.componentWillUnmount,e.componentWillUnmount=function(){i(),e.__c&&e.__c()};var s=function(){var t;if(!--n.__u)for(n.__v.__k[0]=Z(n.state.o),n.setState({o:n.__b=null});t=n.t.pop();)t.forceUpdate()};n.__u++||n.setState({o:n.__b=n.__v.__k[0]}),t.then(i,i)},K.prototype.componentWillUnmount=function(){this.t=[]},K.prototype.render=function(t,e){return this.__b&&(this.__v.__k&&(this.__v.__k[0]=q(this.__b)),this.__b=null),[u(p,null,e.o?null:t.children),e.o&&t.fallback]};var Y=function(t,e,n){if(++n[1]===n[0]&&t.i.delete(e),t.props.revealOrder&&("t"!==t.props.revealOrder[0]||!t.i.size))for(n=t.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.u=n=n[2]}};function tt(t){return this.getChildContext=function(){return t.context},t.children}function et(t){var e=this,n=t.l,r=u(tt,{context:e.context},t.__v);e.componentWillUnmount=function(){var t=e.s.parentNode;t&&t.removeChild(e.s),j(e.v)},e.l&&e.l!==n&&(e.componentWillUnmount(),e.h=!1),t.__v?e.h?(n.__k=e.__k,E(r,n),e.__k=n.__k):(e.s=document.createTextNode(""),e.__k=n.__k,function(t,e){E(t,e,i)}("",n),n.appendChild(e.s),e.h=!0,e.l=n,E(r,n,e.s),n.__k=e.__k,e.__k=e.s.__k):e.h&&e.componentWillUnmount(),e.v=r}function nt(t,e){return u(et,{__v:t,l:e})}(X.prototype=new _).o=function(t){var e=this,n=Q(e.__v),r=e.i.get(t);return r[0]++,function(o){var i=function(){e.props.revealOrder?(r.push(o),Y(e,t,r)):o()};n?n(i):i()}},X.prototype.render=function(t){this.u=null,this.i=new Map;var e=y(t.children);t.revealOrder&&"b"===t.revealOrder[0]&&e.reverse();for(var n=e.length;n--;)this.i.set(e[n],this.u=[1,0,this.u]);return t.children},X.prototype.componentDidUpdate=X.prototype.componentDidMount=function(){var t=this;this.i.forEach((function(e,n){Y(t,n,e)}))};var rt=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/;_.prototype.isReactComponent={};var ot="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,it=e.event;function st(t,e){t["UNSAFE_"+e]&&!t[e]&&Object.defineProperty(t,e,{get:function(){return this["UNSAFE_"+e]},set:function(t){this["UNSAFE_"+e]=t}})}e.event=function(t){it&&(t=it(t)),t.persist=function(){};var e=!1,n=!1,r=t.stopPropagation;t.stopPropagation=function(){r.call(t),e=!0};var o=t.preventDefault;return t.preventDefault=function(){o.call(t),n=!0},t.isPropagationStopped=function(){return e},t.isDefaultPrevented=function(){return n},t.nativeEvent=t};var at={configurable:!0,get:function(){return this.class}},lt=e.vnode;e.vnode=function(t){t.$$typeof=ot;var e=t.type,n=t.props;if(e){var r;if(n.class!=n.className&&(at.enumerable="className"in n,null!=n.className&&(n.class=n.className),Object.defineProperty(n,"className",at)),"function"!=typeof e)for(r in n.defaultValue&&void 0!==n.value&&(n.value||0===n.value||(n.value=n.defaultValue),n.defaultValue=void 0),"select"===e&&n.multiple&&Array.isArray(n.value)&&(y(n.children).forEach((function(t){-1!=n.value.indexOf(t.props.value)&&(t.props.selected=!0)})),n.value=void 0),!0===n.download&&(n.download=""),n){var o=rt.test(r);o&&(t.props[r.replace(/[A-Z0-9]/,"-$&").toLowerCase()]=n[r]),(o||null===n[r])&&(n[r]=void 0)}else e.prototype&&!e.prototype.p&&(e.prototype.p=!0,st(e.prototype,"componentWillMount"),st(e.prototype,"componentWillReceiveProps"),st(e.prototype,"componentWillUpdate"));!function(e){var n=t.type,r=t.props;if(r&&"string"==typeof n){var o={};for(var i in r)/^on(Ani|Tra|Tou)/.test(i)&&(r[i.toLowerCase()]=r[i],delete r[i]),o[i.toLowerCase()]=i;if(o.ondoubleclick&&(r.ondblclick=r[o.ondoubleclick],delete r[o.ondoubleclick]),o.onbeforeinput&&(r.onbeforeinput=r[o.onbeforeinput],delete r[o.onbeforeinput]),o.onchange&&("textarea"===n||"input"===n.toLowerCase()&&!/^fil|che|ra/i.test(r.type))){var s=o.oninput||"oninput";r[s]||(r[s]=r[o.onchange],delete r[o.onchange])}}}()}lt&&lt(t)};var dt=e.__r;e.__r=function(t){dt&&dt(t),t.__c};var ct;const ut={source:{e:[1,.6],w:[0,.6],s:[.5,1]},target:{n:[.5,0],e:[1,.4],w:[0,.4]}},ht=["n","e","s","w"];function pt(t,e){return t.each((t,n)=>{$(n).triggerHandler(e)})}function _t(t){return t.substring(t.indexOf("translate(")+10,t.indexOf(")")).split(",")}class ft{constructor(){}debounce(t,e){return function(n){let r=this.lastCall;this.lastCall=Date.now(),r&&this.lastCall-r<=e&&clearTimeout(this.lastCallTimer),this.lastCallTimer=setTimeout(()=>t(n),e)}}}class vt extends _{constructor(t){super(t),this.maindiv={current:null}}componentDidMount(){this.updateJSON({},function(){this.maindiv.current&&(this.maindiv.current.react=this),this.postMountFunction(),initial_loading&&$(document).triggerHandler("component-loaded",this.objectType)}.bind(this))}updateJSON(t,e){var n=this.setState.bind(this);try{$.getJSON("/"+this.objectType+"/read/"+this.props.objectID,(function(t){n(t,e)}))}catch(t){}}postMountFunction(){}setJSON(t,e){var n={};n[t]=e,this.setState(n,()=>updateValue(this.props.objectID,this.objectType,n))}addDeleteSelf(t=this.state.id,e=this.objectType,n=(()=>{pt($(this.objectClass),"sibling-removed")})){return u(bt,{handleClick:deleteSelf.bind(this,t,e,()=>{this.maindiv.current&&$(this.maindiv.current).triggerHandler("deleted"),this.props.updateParent({},n)})})}addInsertSibling(t=this.state.id,e=this.props.parentID,n=this.objectType,r){return u(yt,{handleClick:insertSibling.bind(this,t,n,e,()=>{this.props.updateParent({},r)})})}addEditable(){if(this.state.selected){var t=this.objectType;return u("div",{class:"right-panel-container edit-bar-container"},u("div",{class:"right-panel-inner"},u("h3",null,"Edit:"),["node","strategy","column"].indexOf(t)>=0&&u("div",null,u("h4",null,"Title:"),u("input",{value:this.state.title})),["node","strategy"].indexOf(t)>=0&&u("div",null,u("h4",null,"Description:"),u("input",{value:this.state.description})),this.addDeleteSelf()))}}makeSortable(t,e,n,r,o=!1,i=!1,s="",a=!1){t.sortable({containment:".workflow-container",axis:o,cursor:"move",grid:i,cursorAt:{top:20},connectWith:s,handle:a,tolerance:"pointer",distance:10,start:(e,o)=>{t.data("last_order",t.sortable("toArray")),$(".workflow-canvas").addClass("dragging-"+n),$(r).addClass("dragging"),t.sortable("refresh");var i=$(t).sortable("instance");if(a){var s=$(i.currentItem).children(a);s=s[0],i.containment[0]-=s.offsetLeft,i.containment[2]+=i.currentItem[0].offsetWidth-s.offsetWidth-s.offsetLeft}i.containment[3]+=i.currentItem[0].offsetTop},sort:(t,e)=>{var n;e.placeholder.parent()==e.item.parent()&&e.item.index(":not(ui-sortable-placeholder)")==e.placeholder.index(":not(ui-sortable-helper)")||(e.item.parent()!=e.placeholder.parent()&&(n=e.item.siblings(r)),e.item.insertAfter(e.placeholder),n&&pt(n,"sorted"),pt(e.item.siblings(r),"sorted"));e.item.triggerHandler("dragging")},remove:(t,e)=>{var r=e.item[0].id;this.childRemoved.bind(this)(n,parseInt(r))},receive:(t,r)=>{r.item[0].id;var o=r.item.index();r.item[0].classList.contains("node-bar-sortable")&&this.newChild.bind(this)(n,e,o,r)},stop:(t,o)=>{var i=o.item.attr("id"),s=o.item.index(),a=parseInt(o.item[0].parentElement.id);a&&a!=e||this.childAdded.bind(this)(n,parseInt(i),s),$(r).removeClass("dragging"),$("#container").animate({scrollTop:o.item.offset().top-200},20);var l=Math.round((o.position.left-o.originalPosition.left)/200),d=-1;if("nodestrategy"==n&&l){var c=o.item.children(".node"),u=c[0].react.state.columnworkflow;try{(d=ct[ct.indexOf(u)+l])&&c[0].react.setState({columnworkflow:d})}catch(t){console.log("could not change column")}}insertedAt(i,n,e,s,a,d,()=>{pt($(r),"sorted"),$(".workflow-canvas").removeClass("dragging-"+n)})}})}childRemoved(t,e){try{var n=this.state[t+"_set"];n.indexOf(e)>=0&&n.splice(n.indexOf(e),1)}catch(t){}}childAdded(t,e,n){try{var r=this.state[t+"_set"];r.indexOf(e)>=0&&r.splice(r.indexOf(e),1),r.splice(n,0,e)}catch(t){}}newChild(t,e,n,r){"nodestrategy"==t&&newNode(e,n,r.item[0].sortableData.column,this.updateJSON.bind(this)),r.item.remove()}}function gt(t){return u("p",null,t.text)}class mt extends _{constructor(t){super(t),this.updateText=this.updateText.bind(this)}render(){var t=this.props.text;return null!=this.props.text&&""!=this.props.text||null==this.props.defaultText||(t=this.props.defaultText),this.text=t,u("input",{value:t,onBlur:this.updateText})}updateText(t){var e=t.target.value;e!=this.text&&(""==e&&(e=null),this.props.textUpdated(t.target.value))}}class bt extends _{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"delete-self-button",onClick:this.handleClick},"x")}handleClick(t){this.props.handleClick(t)}}class yt extends _{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"insert-sibling-button",onClick:this.handleClick},"+")}handleClick(t){this.props.handleClick(t)}}class kt extends vt{constructor(t){super(t),this.objectType="nodelink",this.objectClass=".node-link",this.rerenderEvents="ports-rendered."+this.eventNameSpace,this.updateParentEvents="deleted."+this.eventNameSpace}render(){if(this.state.id)if(initial_loading)$(document).on("render-links",this.rerender.bind(this));else if(ports_rendered){this.source_node&&0!=this.source_node.length&&0!=this.target_node.length||(this.source_node=$("#"+this.state.source_node+".node"),this.source_port_handle=d3.select("g.port-"+this.state.source_node+" circle[data-port-type='source'][data-port='"+ht[this.state.source_port]+"']"),this.target_node=$("#"+this.state.target_node+".node"),this.target_port_handle=d3.select("g.port-"+this.state.target_node+" circle[data-port-type='target'][data-port='"+ht[this.state.target_port]+"']"),this.target_node.on(this.rerenderEvents,this.rerender.bind(this)),this.target_node.on(this.updateParentEvents,this.props.updateParent));var t=this;return u("div",null,nt(u(St,{source_port_handle:this.source_port_handle,target_port_handle:this.target_port_handle,clickFunction:e=>selection_manager.changeSelection(e,t),selected:this.state.selected}),$(".workflow-canvas")[0]),this.addEditable())}}rerender(){this.setState({})}componentDidUnmount(){this.target_node&&this.target_node.length>0&&(this.target_node.off(this.rerenderEvents),this.target_node.off(this.updateParentEvents))}}class wt extends _{constructor(t){super(t),this.eventNameSpace="autolink"+t.source,this.rerenderEvents="ports-rendered."+this.eventNameSpace}render(){if(initial_loading)$(document).on("render-links",this.rerender.bind(this));else if(ports_rendered){if(this.source_node&&0!=this.source_node.length||(this.source_node=$("#"+this.props.source+".node"),this.source_port_handle=d3.select("g.port-"+this.props.source+" circle[data-port-type='source'][data-port='s']")),this.findAutoTarget(),!this.target_node)return;return u("div",null,nt(u(St,{source_port_handle:this.source_port_handle,target_port_handle:this.target_port_handle}),$(".workflow-canvas")[0]))}}findAutoTarget(){var t=this.source_node.closest(".node-strategy");if(t.next(".node-bar-column").length>0)this.setTarget(null);else{var e,n=t.nextAll(".node-strategy:not(.ui-sortable-placeholder)").first();if(n.length>0)e=n.find(".node").attr("id");else for(var r=t.closest(".strategy-workflow").next();r.length>0&&!(e=r.find(".node-strategy:not(ui-sortable-placeholder) .node").attr("id"));)r=r.next();this.setTarget(e)}}rerender(){this.setState({})}setTarget(t){if(t){if(this.target_node&&t==this.target_node.attr("id"))return;this.target_node&&this.target_node.off(this.rerenderEvents),this.target_node=$("#"+t+".node"),this.target_port_handle=d3.select("g.port-"+t+" circle[data-port-type='target'][data-port='n']"),this.target_node.on(this.rerenderEvents,this.rerender.bind(this)),this.target=t}else this.target_node&&this.target_node.off(this.rerenderEvents),this.target_node=null,this.target_port_handle,this.target=null}}class St extends _{render(){const t=_t(this.props.source_port_handle.select((function(){return this.parentNode})).attr("transform")),e=_t(this.props.target_port_handle.select((function(){return this.parentNode})).attr("transform")),n=[[parseInt(this.props.source_port_handle.attr("cx"))+parseInt(t[0]),parseInt(this.props.source_port_handle.attr("cy"))+parseInt(t[1])]],r=[[parseInt(this.props.target_port_handle.attr("cx"))+parseInt(e[0]),parseInt(this.props.target_port_handle.attr("cy"))+parseInt(e[1])]];return u("path",{stroke:"red","stroke-width":"3px",d:this.getPath(n,r),onClick:this.props.clickFunction,class:"nodelink"+(this.props.selected?" selected":"")})}getPath(t,e){for(var n="M",r=0;r<t.length;r++){r>0&&(n+=" L"),n+=(o=t[r])[0]+" "+o[1]}for(r=e.length-1;r>=0;r--){var o;n+=" L",n+=(o=e[r])[0]+" "+o[1]}return n}}class xt extends _{render(){var t,e,n=[];for(var r in this.props.node_dimensions?(t=this.props.node_dimensions,this.positioned=!0):t={width:0,height:0},ut)for(var o in ut[r])n.push(u("circle",{"data-port-type":r,"data-port":o,"data-node-id":this.props.nodeID,r:"5",key:r+o,cx:ut[r][o][0]*t.width,cy:ut[r][o][1]*t.height}));return e=this.props.node_offset?"translate("+this.props.node_offset.left+","+this.props.node_offset.top+")":"translate(0,0)",u("g",{class:"node-ports port-"+this.props.nodeID,stroke:"black","stroke-width":"2",fill:"white",transform:e},n)}componentDidUpdate(){!ports_rendered&&this.positioned?$(document).triggerHandler("ports-rendered"):ports_rendered&&this.positioned&&$("#"+this.props.nodeID+".node").triggerHandler("ports-rendered")}componentDidMount(){var t=this;d3.selectAll("g.port-"+this.props.nodeID+" circle[data-port-type='source']").call(d3.drag().on("start",(function(t){var e=$(".workflow-canvas").offset();d3.select(".node-link-creator").remove(),d3.select(".workflow-canvas").append("line").attr("class","node-link-creator").attr("x1",event.x-e.left).attr("y1",event.y-e.top).attr("x2",event.x-e.left).attr("y2",event.y-e.top).attr("stroke","red").attr("stroke-width","2")})).on("drag",(function(t){var e=$(".workflow-canvas").offset();d3.select(".node-link-creator").attr("x2",event.x-e.left).attr("y2",event.y-e.top)})).on("end",(function(e){var n=d3.select(event.target);"target"==n.attr("data-port-type")&&t.props.nodeLinkAdded(n.attr("data-node-id"),d3.select(this).attr("data-port"),n.attr("data-port")),d3.select(".node-link-creator").remove()})))}}class Ct extends vt{constructor(t){super(t),this.objectType="node",this.objectClass=".node"}render(){if(this.state.id){var t=this.state.outgoing_links.map(t=>u(kt,{key:t,objectID:t,parentID:this.state.id,updateParent:()=>{console.log("update parent"),this.updateJSON.bind(this)()}}));return u("div",{class:"node column-"+this.state.columnworkflow+(this.state.selected?" selected":""),id:this.state.id,ref:this.maindiv,onClick:t=>selection_manager.changeSelection(t,this)},u(mt,{text:this.state.title,defaultText:"New Node",textUpdated:this.setJSON.bind(this,"title")}),u(mt,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),this.addEditable(),nt(u(xt,{nodeID:this.props.objectID,nodeLinkAdded:this.nodeLinkAdded.bind(this),node_offset:this.state.node_offset,node_dimensions:this.state.node_dimensions,updateParent:this.updateJSON.bind(this)}),$(".workflow-canvas")[0]),t,u(wt,{source:this.props.objectID,node_offset:this.state.node_offset,node_dimensions:this.state.node_dimensions}))}}updatePorts(){var t=$(this.maindiv.current),e=function(t){var e=t.offset(),n=$(".workflow-canvas").offset();return e.left-=n.left,e.top-=n.top,e}(t),n={width:t.width(),height:t.height()};t.closest(".strategy-workflow").hasClass("dragging")||this.state.node_offset==e&&this.state.node_dimensions==n||this.setState({node_offset:e,node_dimensions:n})}createNodeLinkSVG(){this.state.has_autolink&&(this.svg=new St("nodeautolink"+this.state.id,this.state.id))}nodeLinkAdded(t,e,n){if(t!=this.props.objectID)try{newNodeLink(this.props.objectID,t,ht.indexOf(e),ht.indexOf(n),this.updateJSON.bind(this))}catch(t){}}postMountFunction(){this.maindiv.current&&(initial_loading?$(document).on("render-ports",this.updatePorts.bind(this)):(this.updatePorts(),pt($(".strategy-workflow").not($(this.maindiv.current).parent()),"sibling-added")),$(this.maindiv.current).on("parent-moved sorted dragging sibling-added sibling-removed cousin-added cousin-removed",this.updatePorts.bind(this)))}}class Nt extends vt{constructor(t){super(t),this.objectType="nodestrategy",this.objectClass=".node-strategy"}render(){if(this.state.id)return u("div",{class:"node-strategy",id:this.state.id,ref:this.maindiv},u(Ct,{updateParent:this.props.updateParent,objectID:this.state.node}))}passEventToChild(t){$(this.maindiv.current).children(".node").triggerHandler(t.type)}postMountFunction(){if(this.maindiv.current){var t=this;$(this.maindiv.current).on("sorted dragging sibling-added sibling-removed",this.updateRank.bind(this)),$(this.maindiv.current).on("parent-moved sibling-added sibling-removed cousin-added cousin-removed sorted dragging",e=>{t.passEventToChild(e)})}}updateRank(){var t=$(this.maindiv.current).index(".node-strategy:not(.ui-sortable-placeholder)");this.state.rank!=t&&this.setState({rank:t})}}class Dt extends vt{constructor(t){super(t),this.objectType="strategy",this.objectClass=".strategy",this.node_block={current:null}}render(){if(this.state.id){var t=this.state.nodestrategy_set.map(t=>u(Nt,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{class:"strategy"+(this.state.selected?" selected":""),ref:this.maindiv,onClick:t=>selection_manager.changeSelection(t,this)},u(mt,{text:this.state.title,defaultText:this.state.strategy_type_display+" "+(this.props.rank+1),textUpdated:this.setJSON.bind(this,"title")}),u(mt,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newNode(this.state.id,-1,-1,this.updateJSON.bind(this))},"Add A Node"),u("div",{class:"node-block",id:this.props.objectID+"-node-block",ref:this.node_block},t),this.addEditable())}}postMountFunction(){initial_loading||pt($(".strategy-workflow").not($(this.maindiv.current).parent()),"sibling-added"),this.makeSortable($(this.node_block.current),this.props.objectID,"nodestrategy",".node-strategy",!1,[200,1],".node-block",".node"),$(this.maindiv.current).on("sorted sibling-added sibling-removed",()=>{pt($(this.node_block.current).children(),"parent-moved")})}}class $t extends vt{constructor(t){super(t),this.objectType="column",this.objectClass=".column"}render(){if(this.state.id){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"column"+(this.state.selected?" selected":""),onClick:t=>selection_manager.changeSelection(t,this)},t,this.addEditable())}}}class It extends vt{constructor(t){super(t),this.objectType="columnworkflow",this.objectClass=".column-workflow",$("<style>").prop("type","text/css").prop("id","column-"+this.props.objectID+"-CSS").appendTo("head")}render(){return this.state.id?(this.updateCSS(),u("div",{class:"column-workflow column-"+this.state.id,id:this.state.id,ref:this.maindiv},u($t,{objectID:this.state.column,updateParent:this.props.updateParent}),this.addDeleteSelf(this.state.column,"column",()=>pt($(".column-workflow"),"sibling-removed")))):u("div",{class:"column-workflow column-"+this.state.id})}passEventToChild(t){$(this.maindiv.current).children(".column").triggerHandler(t.type)}postMountFunction(){if(this.maindiv.current){$(".column-workflow").trigger("sibling-added");var t=this;$(this.maindiv.current).on("dragging sorted sibling-added sibling-removed",this.updateRank.bind(this)),$(this.maindiv.current).on("sibling-added sibling-removed cousin-added cousin-removed sorted dragging",e=>{t.passEventToChild(e)})}}updateCSS(){$("#column-"+this.props.objectID+"-CSS").html(".column-"+this.props.objectID+"{left:"+this.calcDistance()+"px}")}updateRank(){var t=$(this.maindiv.current).index(".column-workflow:not(.ui-sortable-placeholder)");this.state.rank!=t&&this.setState({rank:t},()=>{pt($(".column-"+this.props.objectID+":not(.column-workflow):not(.column)"),"parent-moved")})}calcDistance(){return 200*this.state.rank}}class Tt extends vt{constructor(t){super(t),this.objectType="strategyworkflow",this.objectClass=".strategy-workflow"}render(){if(this.state.id)return u("div",{class:"strategy-workflow",id:this.state.id,ref:this.maindiv},u(Dt,{objectID:this.state.strategy,rank:this.state.rank,updateParent:this.props.updateParent}),this.addDeleteSelf(this.state.strategy,"strategy",()=>pt($(".strategy-workflow"),"sibling-removed")),this.addInsertSibling(this.state.id,this.props.parentID,"strategyworkflow"))}passEventToChild(t){$(this.maindiv.current).children(".strategy").triggerHandler(t.type)}postMountFunction(){if(this.maindiv.current){var t=this;$(this.maindiv.current).on("dragging sorted sibling-added sibling-removed",this.updateRank.bind(this)),$(this.maindiv.current).on("sibling-added sibling-removed cousin-added cousin-removed sorted dragging",e=>{t.passEventToChild(e)})}}updateRank(){var t=$(this.maindiv.current).index(".strategy-workflow:not(.ui-sortable-placeholder)");this.state.rank!=t&&this.setState({rank:t})}}class jt extends vt{constructor(t){super(t),this.objectType=t.type,this.nodebar={current:null}}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>u(It,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)})),e=this.state.strategyworkflow_set.map(t=>u(Tt,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)})),n=this.state.columnworkflow_set.map(t=>u(Pt,{key:t,objectID:t})),r=this.state.strategyworkflow_set.map(t=>u(At,{key:t,objectID:t}));return u("div",{id:"workflow-wrapper",class:"workflow-wrapper"},u("div",{class:"workflow-container"},u(mt,{text:this.state.title,textUpdated:this.setJSON.bind(this,"title")}),u(gt,{text:"Created by "+this.state.author}),u(mt,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newColumn(this.state.id,0,this.updateJSON.bind(this))},"Add A Column"),u("div",{class:"column-row"},t),u("div",{class:"strategy-block"},e),u("svg",{class:"workflow-canvas",width:"100%",height:"100%"})),u("div",{id:"node-bar-container",ref:this.nodebar,class:"node-bar-container right-panel-container"},u("div",{id:"node-bar-workflow",class:"right-panel-inner"},u("div",{class:"node-bar-column-block"},n),u("div",{class:"node-bar-strategy-block"},r))))}}postMountFunction(){this.makeSortable($(".strategy-block"),this.props.objectID,"strategyworkflow",".strategy-workflow","y"),this.makeSortable($(".column-row"),this.props.objectID,"columnworkflow",".column-workflow","x"),$(this.nodebar.current).resizable({containment:"body"})}componentDidUpdate(){this.state&&(ct=this.state.columnworkflow_set)}}class Pt extends vt{constructor(t){super(t),this.objectType="columnworkflow",this.objectClass=".column-workflow"}render(){if(this.state.id)return u("div",{class:"node-bar-column-workflow",ref:this.maindiv},u(Et,{objectID:this.state.column}))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).sortable({connectWith:".node-block",helper:(t,e)=>(this.maindiv.current.copyHelper=e.clone().insertAfter(e),e.clone().appendTo(document.body)),containment:".workflow-container",sort:(t,e)=>{var n;0!=e.placeholder.parent(".node-block").length&&(e.placeholder.parent()==e.helper.parent()&&e.helper.index(":not(ui-sortable-placeholder)")==e.placeholder.index(":not(ui-sortable-helper)")||(e.helper.parent()!=e.placeholder.parent()&&(n=e.helper.siblings(".node-strategy")),e.helper.insertAfter(e.placeholder),n&&pt(n,"sorted"),pt(e.helper.siblings(".node-strategy"),"sorted")))},start:(t,e)=>{e.item[0].sortableData={column:this.state.column}},stop:(t,e)=>{e.item[0].parentElement&&e.item[0].parentElement.classList.contains("node-bar-column-workflow")&&e.item.remove()}})}}class Et extends vt{constructor(t){super(t),this.objectType="column",this.objectClass=".column"}render(){if(this.state){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"node-bar-column node-bar-sortable"},t)}}}class At extends vt{constructor(t){super(t),this.objectType="strategyworkflow",this.objectClass=".strategy-workflow"}render(){}}return t.AutoLinkView=wt,t.ClickEditText=mt,t.ColumnView=$t,t.ColumnWorkflowView=It,t.ComponentJSON=vt,t.DeleteSelfButton=bt,t.InsertSiblingButton=yt,t.NodeBarColumnView=Et,t.NodeBarColumnWorkflowView=Pt,t.NodeBarStrategyWorkflowView=At,t.NodeLinkSVG=St,t.NodeLinkSVGBackup=class{constructor(t,e,n,r=2,o=0,i){this.svg=d3.select(".workflow-canvas").append("path").attr("stroke","red").attr("stroke-width","3px"),i&&this.svg.on("click",(function(){selection_manager.changeSelection(event,i)})),this.source=e,this.target=n,this.source_port=r,this.target_port=o,this.debouncer=new ft,this.source_node=$("#"+e+".node"),this.source_port_handle=d3.select("g.port-"+e+" circle[data-port-type='source'][data-port='"+ht[r]+"']"),this.source_node.on(this.getRerenderEvents(),this.rerender.bind(this)),this.target?this.setTarget(this.target):this.findAutoTarget(),this.target_node&&this.drawSVG(),this.eventNameSpace=t}getRerenderEvents(){return"dragging."+this.eventNameSpace+" sibling-added."+this.eventNameSpace+" sibling-removed."+this.eventNameSpace+" sorted."+this.eventNameSpace+" parent-moved."+this.eventNameSpace}rerender(){this.target||this.findAutoTarget(),this.target_node?this.drawSVG():this.hideSVG()}drawSVG(){const t=_t(this.source_port_handle.select((function(){return this.parentNode})).attr("transform")),e=_t(this.target_port_handle.select((function(){return this.parentNode})).attr("transform")),n=[[parseInt(this.source_port_handle.attr("cx"))+parseInt(t[0]),parseInt(this.source_port_handle.attr("cy"))+parseInt(t[1])]],r=[[parseInt(this.target_port_handle.attr("cx"))+parseInt(e[0]),parseInt(this.target_port_handle.attr("cy"))+parseInt(e[1])]];var o=this.getPath(n,r);this.svg.attr("d",o)}hideSVG(){this.svg.attr("d","")}},t.NodeLinkView=kt,t.NodePorts=xt,t.NodeStrategyView=Nt,t.NodeView=Ct,t.SelectionManager=class{constructor(){this.currentSelection,$(document).on("click",this.changeSelection.bind(this))}changeSelection(t,e){t.stopPropagation(),this.currentSelection&&this.currentSelection.setState({selected:!1}),this.currentSelection=e,this.currentSelection?(this.currentSelection.setState({selected:!0}),$("#node-bar-container").css("display","none")):$("#node-bar-container").css("display","revert")}},t.StrategyView=Dt,t.StrategyWorkflowView=Tt,t.Text=gt,t.WorkflowView=jt,t.renderWorkflowView=function(t,e){E(u(jt,{objectID:t.id,type:t.type}),e)},t.triggerHandlerEach=pt,t}({});
