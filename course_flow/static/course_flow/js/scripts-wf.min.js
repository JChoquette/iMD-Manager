var workflow=function(t){"use strict";var e,n,r,i,s,o={},a=[],l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function d(t,e){for(var n in e)t[n]=e[n];return t}function c(t){var e=t.parentNode;e&&e.removeChild(t)}function u(t,e,n){var r,i,s,o=arguments,a={};for(s in e)"key"==s?r=e[s]:"ref"==s?i=e[s]:a[s]=e[s];if(arguments.length>3)for(n=[n],s=3;s<arguments.length;s++)n.push(o[s]);if(null!=n&&(a.children=n),"function"==typeof t&&null!=t.defaultProps)for(s in t.defaultProps)void 0===a[s]&&(a[s]=t.defaultProps[s]);return h(t,a,r,i,null)}function h(t,n,r,i,s){var o={type:t,props:n,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s};return null==s&&(o.__v=o),null!=e.vnode&&e.vnode(o),o}function p(t){return t.children}function _(t,e){this.props=t,this.context=e}function f(t,e){if(null==e)return t.__?f(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?f(t):null}function g(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return g(t)}}function v(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!m.__r++||i!==e.debounceRendering)&&((i=e.debounceRendering)||r)(m)}function m(){for(var t;m.__r=n.length;)t=n.sort((function(t,e){return t.__v.__b-e.__v.__b})),n=[],t.some((function(t){var e,n,r,i,s,o,a;t.__d&&(o=(s=(e=t).__v).__e,(a=e.__P)&&(n=[],(r=d({},s)).__v=r,i=C(a,s,r,e.__n,void 0!==a.ownerSVGElement,null,n,null==o?f(s):o),N(n,s),i!=o&&g(s)))}))}function y(t,e,n,r,i,s,l,d,u,_){var g,v,m,y,k,w,x,S=r&&r.__k||a,N=S.length;for(u==o&&(u=null!=l?l[0]:N?f(r,0):null),n.__k=[],g=0;g<e.length;g++)if(null!=(y=n.__k[g]=null==(y=e[g])||"boolean"==typeof y?null:"string"==typeof y||"number"==typeof y?h(null,y,null,null,y):Array.isArray(y)?h(p,{children:y},null,null,null):null!=y.__e||null!=y.__c?h(y.type,y.props,y.key,null,y.__v):y)){if(y.__=n,y.__b=n.__b+1,null===(m=S[g])||m&&y.key==m.key&&y.type===m.type)S[g]=void 0;else for(v=0;v<N;v++){if((m=S[v])&&y.key==m.key&&y.type===m.type){S[v]=void 0;break}m=null}k=C(t,y,m=m||o,i,s,l,d,u,_),(v=y.ref)&&m.ref!=v&&(x||(x=[]),m.ref&&x.push(m.ref,null,y),x.push(v,y.__c||k,y)),null!=k?(null==w&&(w=k),u=b(t,y,m,S,l,k,u),_||"option"!=n.type?"function"==typeof n.type&&(n.__d=u):t.value=""):u&&m.__e==u&&u.parentNode!=t&&(u=f(m))}if(n.__e=w,null!=l&&"function"!=typeof n.type)for(g=l.length;g--;)null!=l[g]&&c(l[g]);for(g=N;g--;)null!=S[g]&&I(S[g],S[g]);if(x)for(g=0;g<x.length;g++)D(x[g],x[++g],x[++g])}function b(t,e,n,r,i,s,o){var a,l,d;if(void 0!==e.__d)a=e.__d,e.__d=void 0;else if(i==n||s!=o||null==s.parentNode)t:if(null==o||o.parentNode!==t)t.appendChild(s),a=null;else{for(l=o,d=0;(l=l.nextSibling)&&d<r.length;d+=2)if(l==s)break t;t.insertBefore(s,o),a=o}return void 0!==a?a:s.nextSibling}function k(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||l.test(e)?n:n+"px"}function w(t,e,n,r,i){var s,o;if(i&&"className"==e&&(e="class"),"style"===e)if("string"==typeof n)t.style=n;else{if("string"==typeof r&&(t.style=r=""),r)for(e in r)n&&e in n||k(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||k(t.style,e,n[e])}else"o"===e[0]&&"n"===e[1]?(s=e!==(e=e.replace(/Capture$/,"")),(o=e.toLowerCase())in t&&(e=o),e=e.slice(2),t.l||(t.l={}),t.l[e]=n,n?r||t.addEventListener(e,x,s):t.removeEventListener(e,x,s)):"list"!==e&&"tagName"!==e&&"form"!==e&&"type"!==e&&"size"!==e&&"download"!==e&&"href"!==e&&!i&&e in t?t[e]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==e&&(e!==(e=e.replace(/xlink:?/,""))?null==n||!1===n?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(e)?t.removeAttribute(e):t.setAttribute(e,n))}function x(t){this.l[t.type](e.event?e.event(t):t)}function S(t,e,n){var r,i;for(r=0;r<t.__k.length;r++)(i=t.__k[r])&&(i.__=t,i.__e&&("function"==typeof i.type&&i.__k.length>1&&S(i,e,n),e=b(n,i,i,t.__k,null,i.__e,e),"function"==typeof t.type&&(t.__d=e)))}function C(t,n,r,i,s,o,a,l,c){var u,h,f,g,v,m,b,k,w,x,C,N=n.type;if(void 0!==n.constructor)return null;(u=e.__b)&&u(n);try{t:if("function"==typeof N){if(k=n.props,w=(u=N.contextType)&&i[u.__c],x=u?w?w.props.value:u.__:i,r.__c?b=(h=n.__c=r.__c).__=h.__E:("prototype"in N&&N.prototype.render?n.__c=h=new N(k,x):(n.__c=h=new _(k,x),h.constructor=N,h.render=j),w&&w.sub(h),h.props=k,h.state||(h.state={}),h.context=x,h.__n=i,f=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=N.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=d({},h.__s)),d(h.__s,N.getDerivedStateFromProps(k,h.__s))),g=h.props,v=h.state,f)null==N.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==N.getDerivedStateFromProps&&k!==g&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(k,x),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(k,h.__s,x)||n.__v===r.__v){h.props=k,h.state=h.__s,n.__v!==r.__v&&(h.__d=!1),h.__v=n,n.__e=r.__e,n.__k=r.__k,h.__h.length&&a.push(h),S(n,l,t);break t}null!=h.componentWillUpdate&&h.componentWillUpdate(k,h.__s,x),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(g,v,m)}))}h.context=x,h.props=k,h.state=h.__s,(u=e.__r)&&u(n),h.__d=!1,h.__v=n,h.__P=t,u=h.render(h.props,h.state,h.context),h.state=h.__s,null!=h.getChildContext&&(i=d(d({},i),h.getChildContext())),f||null==h.getSnapshotBeforeUpdate||(m=h.getSnapshotBeforeUpdate(g,v)),C=null!=u&&u.type==p&&null==u.key?u.props.children:u,y(t,Array.isArray(C)?C:[C],n,r,i,s,o,a,l,c),h.base=n.__e,h.__h.length&&a.push(h),b&&(h.__E=h.__=null),h.__e=!1}else null==o&&n.__v===r.__v?(n.__k=r.__k,n.__e=r.__e):n.__e=T(r.__e,n,r,i,s,o,a,c);(u=e.diffed)&&u(n)}catch(t){n.__v=null,e.__e(t,n,r)}return n.__e}function N(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function T(t,e,n,r,i,s,l,d){var c,u,h,p,_,f=n.props,g=e.props;if(i="svg"===e.type||i,null!=s)for(c=0;c<s.length;c++)if(null!=(u=s[c])&&((null===e.type?3===u.nodeType:u.localName===e.type)||t==u)){t=u,s[c]=null;break}if(null==t){if(null===e.type)return document.createTextNode(g);t=i?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type,g.is&&{is:g.is}),s=null,d=!1}if(null===e.type)f!==g&&t.data!==g&&(t.data=g);else{if(null!=s&&(s=a.slice.call(t.childNodes)),h=(f=n.props||o).dangerouslySetInnerHTML,p=g.dangerouslySetInnerHTML,!d){if(null!=s)for(f={},_=0;_<t.attributes.length;_++)f[t.attributes[_].name]=t.attributes[_].value;(p||h)&&(p&&h&&p.__html==h.__html||(t.innerHTML=p&&p.__html||""))}(function(t,e,n,r,i){var s;for(s in n)"children"===s||"key"===s||s in e||w(t,s,null,n[s],r);for(s in e)i&&"function"!=typeof e[s]||"children"===s||"key"===s||"value"===s||"checked"===s||n[s]===e[s]||w(t,s,e[s],n[s],r)})(t,g,f,i,d),p?e.__k=[]:(c=e.props.children,y(t,Array.isArray(c)?c:[c],e,n,r,"foreignObject"!==e.type&&i,s,l,o,d)),d||("value"in g&&void 0!==(c=g.value)&&c!==t.value&&w(t,"value",c,f.value,!1),"checked"in g&&void 0!==(c=g.checked)&&c!==t.checked&&w(t,"checked",c,f.checked,!1))}return t}function D(t,n,r){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,r)}}function I(t,n,r){var i,s,o;if(e.unmount&&e.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||D(i,null,n)),r||"function"==typeof t.type||(r=null!=(s=t.__e)),t.__e=t.__d=void 0,null!=(i=t.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(t){e.__e(t,n)}i.base=i.__P=null}if(i=t.__k)for(o=0;o<i.length;o++)i[o]&&I(i[o],n,r);null!=s&&c(s)}function j(t,e,n){return this.constructor(t,n)}function P(t,n,r){var i,l,d;e.__&&e.__(t,n),l=(i=r===s)?null:r&&r.__k||n.__k,t=u(p,null,[t]),d=[],C(n,(i?n:r||n).__k=t,l||o,o,void 0!==n.ownerSVGElement,r&&!i?[r]:l?null:n.childNodes.length?a.slice.call(n.childNodes):null,d,r||o,i),N(d,t)}e={__e:function(t,e){for(var n,r;e=e.__;)if((n=e.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(r=!0,n.setState(n.constructor.getDerivedStateFromError(t))),null!=n.componentDidCatch&&(r=!0,n.componentDidCatch(t)),r)return v(n.__E=n)}catch(e){t=e}throw t}},_.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=d({},this.state),"function"==typeof t&&(t=t(d({},n),this.props)),t&&d(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),v(this))},_.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),v(this))},_.prototype.render=p,n=[],r="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,m.__r=0,s=o;var E;const O={source:{e:[1,.6],w:[0,.6],s:[.5,1]},target:{n:[.5,0],e:[1,.4],w:[0,.4]}},A=["n","e","s","w"];function M(t,e){return t.each((t,n)=>{$(n).triggerHandler(e)})}class V{constructor(){}debounce(t,e){return function(n){let r=this.lastCall;this.lastCall=Date.now(),r&&this.lastCall-r<=e&&clearTimeout(this.lastCallTimer),this.lastCallTimer=setTimeout(()=>t(n),e)}}}class U extends _{constructor(t){super(t),this.maindiv={current:null}}componentDidMount(){this.updateJSON({},function(){this.maindiv.current&&(this.maindiv.current.react=this),this.postMountFunction()}.bind(this))}updateJSON(t,e){var n=this.setState.bind(this);try{$.getJSON("/"+this.objectType+"/read/"+this.props.objectID,(function(t){n(t,e)}))}catch(t){}}postMountFunction(){}setJSON(t,e){var n={};n[t]=e,this.setState(n,()=>updateValue(this.props.objectID,this.objectType,n))}addDeleteSelf(t=this.state.id,e=this.objectType,n){return u(F,{handleClick:deleteSelf.bind(this,t,e,()=>{this.props.updateParent({},n)})})}addInsertSibling(t=this.state.id,e=this.props.parentID,n=this.objectType,r){return u(L,{handleClick:insertSibling.bind(this,t,n,e,()=>{this.props.updateParent({},r)})})}makeSortable(t,e,n,r,i=!1,s=!1,o="",a=!1){t.sortable({containment:".workflow-container",axis:i,cursor:"move",grid:s,cursorAt:{top:20},connectWith:o,handle:a,tolerance:"pointer",start:(e,n)=>{$(".workflow-canvas").addClass("dragging"),$(r).addClass("dragging"),t.sortable("refresh");var i=$(t).sortable("instance");if(a){var s=$(i.currentItem).children(a);s=s[0],i.containment[0]-=s.offsetLeft,i.containment[2]+=i.currentItem[0].offsetWidth-s.offsetWidth-s.offsetLeft}i.containment[3]+=i.currentItem[0].offsetTop},sort:(t,e)=>{$(e.item[0]).triggerHandler("dragging")},change:(e,n)=>{M($(t).children(r),"sorted")},remove:(e,i)=>{var s=i.item[0].id;this.childRemoved.bind(this)(n,parseInt(s)),M($(t).children(r),"sibling-removed"),M($(r).not($(t).children()),"cousin-removed")},receive:(i,s)=>{var o=s.item[0].id,a=$(s.item[0]).index();s.item[0].classList.contains("node-bar-sortable")?this.newChild.bind(this)(n,e,a,s):this.childAdded.bind(this)(n,parseInt(o),a),$(t).children(r).triggerHandler("sibling-added"),M($(r).not($(t).children()),"cousin-added")},stop:(t,i)=>{var s=i.item[0].id,o=$(i.item[0]).index(),a=parseInt(i.item[0].parentElement.id);a&&a!=e||this.childAdded.bind(this)(n,parseInt(s),o),$(r).removeClass("dragging"),$("#container").animate({scrollTop:$(i.item[0]).offset().top-200},20);var l=Math.round((i.position.left-i.originalPosition.left)/200),d=-1;if("nodestrategy"==n&&l){var c=i.item.children(".node"),u=c[0].react.state.columnworkflow;try{(d=E[E.indexOf(u)+l])&&c[0].react.setState({columnworkflow:d})}catch(t){console.log("could not change column")}}insertedAt(s,n,e,o,a,d,()=>{M($(r),"sorted"),$(".workflow-canvas").removeClass("dragging")})}})}childRemoved(t,e){try{var n=this.state[t+"_set"];n.indexOf(e)>=0&&n.splice(n.indexOf(e),1)}catch(t){}}childAdded(t,e,n){try{var r=this.state[t+"_set"];r.indexOf(e)>=0&&r.splice(r.indexOf(e),1),r.splice(n,0,e)}catch(t){}}newChild(t,e,n,r){"nodestrategy"==t&&newNode(e,n,r.item[0].sortableData.column,this.updateJSON.bind(this)),r.item.remove()}}function W(t){return u("p",null,t.text)}class J extends _{constructor(t){super(t),this.updateText=this.updateText.bind(this)}render(){var t=this.props.text;return null!=this.props.text&&""!=this.props.text||null==this.props.defaultText||(t=this.props.defaultText),this.text=t,u("input",{value:t,onBlur:this.updateText})}updateText(t){var e=t.target.value;e!=this.text&&(""==e&&(e=null),this.props.textUpdated(t.target.value))}}class F extends _{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"delete-self-button",onClick:this.handleClick},"x")}handleClick(t){this.props.handleClick(t)}}class L extends _{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"insert-sibling-button",onClick:this.handleClick},"+")}handleClick(t){this.props.handleClick(t)}}function R(t){return t.substring(t.indexOf("translate(")+10,t.indexOf(")")).split(",")}class H{constructor(t,e,n,r=2,i=0){this.svg=d3.select(".workflow-canvas").append("path").attr("stroke","red").attr("stroke-width","3px"),this.source=e,this.target=n,this.source_port=r,this.target_port=i,this.debouncer=new V,this.source_node=$("#"+e+".node"),this.source_port_handle=d3.select("g.port-"+e+" circle[data-port-type='source'][data-port='"+A[r]+"']"),this.source_node.on("dragging sibling-added sibling-removed sorted dragging",this.rerender.bind(this)),this.target?this.setTarget(this.target):this.findAutoTarget(),this.target_node&&this.drawSVG(),this.eventNameSpace=t}setTarget(t){if(t){if(this.target_node&&t==this.target_node.attr("id"))return;this.target_node&&this.target_node.off(this.getRerenderEvents()),this.target_node=$("#"+t+".node"),this.target_port_handle=d3.select("g.port-"+t+" circle[data-port-type='target'][data-port='"+A[this.target_port]+"']"),this.target_node.on(this.getRerenderEvents(),this.rerender.bind(this)),this.target&&(this.target=t)}else this.target_node&&this.target_node.off(this.getRerenderEvents()),this.target_node,this.target_port_handle}getRerenderEvents(){return"dragging."+this.eventNameSpace+" sibling-added."+this.eventNameSpace+" sibling-removed."+this.eventNameSpace+" sorted."+this.eventNameSpace+" dragging."+this.eventNameSpace}findAutoTarget(){var t,e=this.source_node.closest(".node-strategy"),n=e.next();if(n.length>0)t=n.find(".node").attr("id");else{var r=e.closest(".strategy-workflow").next();r.length>0&&(t=r.find(".node").attr("id"))}console.log(t),this.setTarget(t)}rerender(){this.target||this.findAutoTarget(),this.target_node?this.drawSVG():this.hideSVG()}drawSVG(){const t=R(this.source_port_handle.select((function(){return this.parentNode})).attr("transform")),e=R(this.target_port_handle.select((function(){return this.parentNode})).attr("transform")),n=[[parseInt(this.source_port_handle.attr("cx"))+parseInt(t[0]),parseInt(this.source_port_handle.attr("cy"))+parseInt(t[1])]],r=[[parseInt(this.target_port_handle.attr("cx"))+parseInt(e[0]),parseInt(this.target_port_handle.attr("cy"))+parseInt(e[1])]];var i=this.getPath(n,r);this.svg.attr("d",i)}hideSVG(){console.log("hide svg"),this.svg.attr("d","")}getPath(t,e){for(var n="M",r=0;r<t.length;r++){r>0&&(n+=" L"),n+=(i=t[r])[0]+" "+i[1]}for(r=e.length-1;r>=0;r--){var i;n+=" L",n+=(i=e[r])[0]+" "+i[1]}return n}}class B extends U{constructor(t){super(t),this.objectType="nodelink"}render(){}postMountFunction(){this.svg=new H("nodelink"+this.state.id,this.state.source_node,this.state.target_node,this.state.source_port,this.state.target_port)}}class G extends U{constructor(t){super(t),this.objectType="node";var e=d3.select(".workflow-canvas").append("g").attr("stroke","black").attr("fill","white").attr("stroke-width",2).attr("class","node-ports port-"+t.objectID);for(var n in O)for(var r in O[n])e.append("circle").attr("data-port-type",n).attr("data-port",r).attr("r",5)}render(){if(this.state.id){var t=this.state.outgoing_links.map(t=>u(B,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{class:"node column-"+this.state.columnworkflow,id:this.state.id,ref:this.maindiv},u(J,{text:this.state.title,defaultText:"New Node",textUpdated:this.setJSON.bind(this,"title")}),u(J,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),t)}}updatePorts(){var t=function(t){var e=t.offset(),n=$(".workflow-canvas").offset();return e.left-=n.left,e.top-=n.top,e}($(this.maindiv.current));d3.select("g.port-"+this.props.objectID).attr("transform","translate("+t.left+","+t.top+")")}placePorts(){var t=$(this.maindiv.current),e={width:t.width(),height:t.height()};d3.selectAll("g.port-"+this.props.objectID+" circle").datum(e).each((function(t){var e=d3.select(this),n=O[e.attr("data-port-type")][e.attr("data-port")];e.attr("cx",n[0]*t.width).attr("cy",n[1]*t.height)})),this.updatePorts()}postMountFunction(){this.maindiv.current&&(this.placePorts(),$(this.maindiv.current).on("sorted",this.updatePorts.bind(this)),this.state.has_autolink&&(this.svg=new H("nodeautolink"+this.state.id,this.state.id)))}}class z extends U{constructor(t){super(t),this.objectType="nodestrategy"}render(){if(this.state.id)return u("div",{class:"node-strategy",id:this.state.id,ref:this.maindiv},u(G,{objectID:this.state.node}))}passEventToChild(t){$(this.maindiv.current).children(".node").triggerHandler(t.type)}postMountFunction(){if(this.maindiv.current){var t=this;$(this.maindiv.current).on("sorted sibling-added sibling-removed",this.updateRank.bind(this)),$(this.maindiv.current).on("sibling-added sibling-removed cousin-added cousin-removed sorted dragging",e=>{t.passEventToChild(e)})}}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}}class q extends U{constructor(t){super(t),this.objectType="strategy"}render(){if(this.state.id){var t=this.state.nodestrategy_set.map(t=>u(z,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{class:"strategy"},u(J,{text:this.state.title,defaultText:this.state.strategy_type_display+" "+(this.props.rank+1),textUpdated:this.setJSON.bind(this,"title")}),u(J,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newNode(this.state.id,-1,-1,this.updateJSON.bind(this))},"Add A Node"),u("div",{class:"node-block",id:this.props.objectID+"-node-block",ref:this.maindiv},t))}}postMountFunction(){this.makeSortable($(this.maindiv.current),this.props.objectID,"nodestrategy",".node-strategy",!1,[200,10],".node-block",".node")}}class K extends U{constructor(t){super(t),this.objectType="column"}render(){if(this.state.id){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"column"},t)}}}class Q extends U{constructor(t){super(t),this.objectType="columnworkflow",$("<style>").prop("type","text/css").prop("id","column-"+this.props.objectID+"-CSS").appendTo("head")}render(){return this.state.id?(this.updateCSS(),u("div",{class:"column-workflow column-"+this.state.id,id:this.state.id,ref:this.maindiv},u(K,{objectID:this.state.column}),this.addDeleteSelf(this.state.column,"column",()=>$(".column-workflow").trigger("columnworkflow-reordered")))):u("div",{class:"column-workflow column-"+this.state.id})}passEventToChild(t){$(this.maindiv.current).children(".column").triggerHandler(t.type)}postMountFunction(){if(this.maindiv.current){$(".column-workflow").trigger("sibling-added");var t=this;$(this.maindiv.current).on("sorted sibling-added sibling-removed",this.updateRank.bind(this)),$(this.maindiv.current).on("sibling-added sibling-removed cousin-added cousin-removed sorted dragging",e=>{t.passEventToChild(e)})}}updateCSS(){$("#column-"+this.props.objectID+"-CSS").html(".column-"+this.props.objectID+"{left:"+this.calcDistance()+"px}")}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}calcDistance(){return 200*this.state.rank}}class X extends U{constructor(t){super(t),this.objectType="strategyworkflow"}render(){if(this.state.id)return u("div",{class:"strategy-workflow",id:this.state.id,ref:this.maindiv},u(q,{objectID:this.state.strategy,rank:this.state.rank}),this.addDeleteSelf(this.state.strategy,"strategy",()=>$(".strategy-workflow").trigger("strategyworkflow-reordered")),this.addInsertSibling(this.state.id,this.props.parentID,"strategyworkflow"))}passEventToChild(t){$(this.maindiv.current).children(".strategy").triggerHandler(t.type)}postMountFunction(){if(this.maindiv.current){$(".strategy-workflow").trigger("sibling-added");var t=this;$(this.maindiv.current).on("sorted sibling-added sibling-removed",this.updateRank.bind(this)),$(this.maindiv.current).on("sibling-added sibling-removed cousin-added cousin-removed sorted dragging",e=>{t.passEventToChild(e)})}}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}}class Y extends U{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>u(Q,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)})),e=this.state.strategyworkflow_set.map(t=>u(X,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{id:"workflow-wrapper",class:"workflow-wrapper"},u("div",{class:"workflow-container"},u(J,{text:this.state.title,textUpdated:this.setJSON.bind(this,"title")}),u(W,{text:"Created by "+this.state.author}),u(J,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newColumn(this.state.id,0,this.updateJSON.bind(this))},"Add A Column"),u("div",{class:"column-row"},t),u("div",{class:"strategy-block"},e),u("svg",{class:"workflow-canvas",width:"100%",height:"100%"})))}}postMountFunction(){this.makeSortable($(".strategy-block"),this.props.objectID,"strategyworkflow",".strategy-workflow","y"),this.makeSortable($(".column-row"),this.props.objectID,"columnworkflow",".column-workflow","x")}componentDidUpdate(){this.state&&(E=this.state.columnworkflow_set)}}class Z extends U{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>u(tt,{key:t,objectID:t})),e=this.state.strategyworkflow_set.map(t=>u(nt,{key:t,objectID:t}));return u("div",{id:"node-bar-workflow",class:"node-bar-workflow",ref:this.maindiv},u("div",{class:"node-bar-column-block"},t),u("div",{class:"node-bar-strategy-block"},e))}}postMountFunction(){$(this.maindiv.current.parentElement).resizable({containment:"body"})}}class tt extends U{constructor(t){super(t),this.objectType="columnworkflow"}render(){if(this.state.id)return u("div",{class:"node-bar-column-workflow",ref:this.maindiv},u(et,{objectID:this.state.column}))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).sortable({connectWith:".node-block",helper:(t,e)=>(this.maindiv.current.copyHelper=e.clone().insertAfter(e),e.clone().appendTo(document.body)),containment:".workflow-container",start:(t,e)=>{e.item[0].sortableData={column:this.state.column}},stop:(t,e)=>{e.item[0].parentElement&&e.item[0].parentElement.classList.contains("node-bar-column-workflow")&&e.item.remove()}})}}class et extends U{constructor(t){super(t),this.objectType="column"}render(){if(this.state){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"node-bar-column node-bar-sortable"},t)}}}class nt extends U{constructor(t){super(t),this.objectType="strategyworkflow"}render(){}}return t.ClickEditText=J,t.ColumnView=K,t.ColumnWorkflowView=Q,t.ComponentJSON=U,t.DeleteSelfButton=F,t.InsertSiblingButton=L,t.NodeBarColumnView=et,t.NodeBarColumnWorkflowView=tt,t.NodeBarStrategyWorkflowView=nt,t.NodeBarWorkflowView=Z,t.NodeLinkSVG=H,t.NodeLinkView=B,t.NodeStrategyView=z,t.NodeView=G,t.StrategyView=q,t.StrategyWorkflowView=X,t.Text=W,t.WorkflowView=Y,t.renderNodeBar=function(t,e){P(u(Z,{objectID:t.id,type:t.type}),e)},t.renderWorkflowView=function(t,e){P(u(Y,{objectID:t.id,type:t.type}),e)},t.triggerHandlerEach=M,t}({});
