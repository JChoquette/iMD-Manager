var workflow=function(t){"use strict";var e,n,o,i,r,s={},l=[],a=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(t,e){for(var n in e)t[n]=e[n];return t}function d(t){var e=t.parentNode;e&&e.removeChild(t)}function u(t,e,n){var o,i,r,s=arguments,l={};for(r in e)"key"==r?o=e[r]:"ref"==r?i=e[r]:l[r]=e[r];if(arguments.length>3)for(n=[n],r=3;r<arguments.length;r++)n.push(s[r]);if(null!=n&&(l.children=n),"function"==typeof t&&null!=t.defaultProps)for(r in t.defaultProps)void 0===l[r]&&(l[r]=t.defaultProps[r]);return h(t,l,o,i,null)}function h(t,n,o,i,r){var s={type:t,props:n,key:o,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:r};return null==r&&(s.__v=s),null!=e.vnode&&e.vnode(s),s}function p(t){return t.children}function _(t,e){this.props=t,this.context=e}function f(t,e){if(null==e)return t.__?f(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?f(t):null}function m(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return m(t)}}function v(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!g.__r++||i!==e.debounceRendering)&&((i=e.debounceRendering)||o)(g)}function g(){for(var t;g.__r=n.length;)t=n.sort((function(t,e){return t.__v.__b-e.__v.__b})),n=[],t.some((function(t){var e,n,o,i,r,s,l;t.__d&&(s=(r=(e=t).__v).__e,(l=e.__P)&&(n=[],(o=c({},r)).__v=o,i=D(l,r,o,e.__n,void 0!==l.ownerSVGElement,null,n,null==s?f(r):s),C(n,r),i!=s&&m(r)))}))}function y(t,e,n,o,i,r,a,c,u,_){var m,v,g,y,w,b,x,S=o&&o.__k||l,C=S.length;for(u==s&&(u=null!=a?a[0]:C?f(o,0):null),n.__k=[],m=0;m<e.length;m++)if(null!=(y=n.__k[m]=null==(y=e[m])||"boolean"==typeof y?null:"string"==typeof y||"number"==typeof y?h(null,y,null,null,y):Array.isArray(y)?h(p,{children:y},null,null,null):null!=y.__e||null!=y.__c?h(y.type,y.props,y.key,null,y.__v):y)){if(y.__=n,y.__b=n.__b+1,null===(g=S[m])||g&&y.key==g.key&&y.type===g.type)S[m]=void 0;else for(v=0;v<C;v++){if((g=S[v])&&y.key==g.key&&y.type===g.type){S[v]=void 0;break}g=null}w=D(t,y,g=g||s,i,r,a,c,u,_),(v=y.ref)&&g.ref!=v&&(x||(x=[]),g.ref&&x.push(g.ref,null,y),x.push(v,y.__c||w,y)),null!=w?(null==b&&(b=w),u=k(t,y,g,S,a,w,u),_||"option"!=n.type?"function"==typeof n.type&&(n.__d=u):t.value=""):u&&g.__e==u&&u.parentNode!=t&&(u=f(g))}if(n.__e=b,null!=a&&"function"!=typeof n.type)for(m=a.length;m--;)null!=a[m]&&d(a[m]);for(m=C;m--;)null!=S[m]&&T(S[m],S[m]);if(x)for(m=0;m<x.length;m++)I(x[m],x[++m],x[++m])}function k(t,e,n,o,i,r,s){var l,a,c;if(void 0!==e.__d)l=e.__d,e.__d=void 0;else if(i==n||r!=s||null==r.parentNode)t:if(null==s||s.parentNode!==t)t.appendChild(r),l=null;else{for(a=s,c=0;(a=a.nextSibling)&&c<o.length;c+=2)if(a==r)break t;t.insertBefore(r,s),l=s}return void 0!==l?l:r.nextSibling}function w(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||a.test(e)?n:n+"px"}function b(t,e,n,o,i){var r,s;if(i&&"className"==e&&(e="class"),"style"===e)if("string"==typeof n)t.style=n;else{if("string"==typeof o&&(t.style=o=""),o)for(e in o)n&&e in n||w(t.style,e,"");if(n)for(e in n)o&&n[e]===o[e]||w(t.style,e,n[e])}else"o"===e[0]&&"n"===e[1]?(r=e!==(e=e.replace(/Capture$/,"")),(s=e.toLowerCase())in t&&(e=s),e=e.slice(2),t.l||(t.l={}),t.l[e]=n,n?o||t.addEventListener(e,x,r):t.removeEventListener(e,x,r)):"list"!==e&&"tagName"!==e&&"form"!==e&&"type"!==e&&"size"!==e&&"download"!==e&&"href"!==e&&!i&&e in t?t[e]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==e&&(e!==(e=e.replace(/xlink:?/,""))?null==n||!1===n?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(e)?t.removeAttribute(e):t.setAttribute(e,n))}function x(t){this.l[t.type](e.event?e.event(t):t)}function S(t,e,n){var o,i;for(o=0;o<t.__k.length;o++)(i=t.__k[o])&&(i.__=t,i.__e&&("function"==typeof i.type&&i.__k.length>1&&S(i,e,n),e=k(n,i,i,t.__k,null,i.__e,e),"function"==typeof t.type&&(t.__d=e)))}function D(t,n,o,i,r,s,l,a,d){var u,h,f,m,v,g,k,w,b,x,D,C=n.type;if(void 0!==n.constructor)return null;(u=e.__b)&&u(n);try{t:if("function"==typeof C){if(w=n.props,b=(u=C.contextType)&&i[u.__c],x=u?b?b.props.value:u.__:i,o.__c?k=(h=n.__c=o.__c).__=h.__E:("prototype"in C&&C.prototype.render?n.__c=h=new C(w,x):(n.__c=h=new _(w,x),h.constructor=C,h.render=j),b&&b.sub(h),h.props=w,h.state||(h.state={}),h.context=x,h.__n=i,f=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=C.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=c({},h.__s)),c(h.__s,C.getDerivedStateFromProps(w,h.__s))),m=h.props,v=h.state,f)null==C.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==C.getDerivedStateFromProps&&w!==m&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(w,x),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(w,h.__s,x)||n.__v===o.__v){h.props=w,h.state=h.__s,n.__v!==o.__v&&(h.__d=!1),h.__v=n,n.__e=o.__e,n.__k=o.__k,h.__h.length&&l.push(h),S(n,a,t);break t}null!=h.componentWillUpdate&&h.componentWillUpdate(w,h.__s,x),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(m,v,g)}))}h.context=x,h.props=w,h.state=h.__s,(u=e.__r)&&u(n),h.__d=!1,h.__v=n,h.__P=t,u=h.render(h.props,h.state,h.context),h.state=h.__s,null!=h.getChildContext&&(i=c(c({},i),h.getChildContext())),f||null==h.getSnapshotBeforeUpdate||(g=h.getSnapshotBeforeUpdate(m,v)),D=null!=u&&u.type==p&&null==u.key?u.props.children:u,y(t,Array.isArray(D)?D:[D],n,o,i,r,s,l,a,d),h.base=n.__e,h.__h.length&&l.push(h),k&&(h.__E=h.__=null),h.__e=!1}else null==s&&n.__v===o.__v?(n.__k=o.__k,n.__e=o.__e):n.__e=N(o.__e,n,o,i,r,s,l,d);(u=e.diffed)&&u(n)}catch(t){n.__v=null,e.__e(t,n,o)}return n.__e}function C(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function N(t,e,n,o,i,r,a,c){var d,u,h,p,_,f=n.props,m=e.props;if(i="svg"===e.type||i,null!=r)for(d=0;d<r.length;d++)if(null!=(u=r[d])&&((null===e.type?3===u.nodeType:u.localName===e.type)||t==u)){t=u,r[d]=null;break}if(null==t){if(null===e.type)return document.createTextNode(m);t=i?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type,m.is&&{is:m.is}),r=null,c=!1}if(null===e.type)f!==m&&t.data!==m&&(t.data=m);else{if(null!=r&&(r=l.slice.call(t.childNodes)),h=(f=n.props||s).dangerouslySetInnerHTML,p=m.dangerouslySetInnerHTML,!c){if(null!=r)for(f={},_=0;_<t.attributes.length;_++)f[t.attributes[_].name]=t.attributes[_].value;(p||h)&&(p&&h&&p.__html==h.__html||(t.innerHTML=p&&p.__html||""))}(function(t,e,n,o,i){var r;for(r in n)"children"===r||"key"===r||r in e||b(t,r,null,n[r],o);for(r in e)i&&"function"!=typeof e[r]||"children"===r||"key"===r||"value"===r||"checked"===r||n[r]===e[r]||b(t,r,e[r],n[r],o)})(t,m,f,i,c),p?e.__k=[]:(d=e.props.children,y(t,Array.isArray(d)?d:[d],e,n,o,"foreignObject"!==e.type&&i,r,a,s,c)),c||("value"in m&&void 0!==(d=m.value)&&d!==t.value&&b(t,"value",d,f.value,!1),"checked"in m&&void 0!==(d=m.checked)&&d!==t.checked&&b(t,"checked",d,f.checked,!1))}return t}function I(t,n,o){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,o)}}function T(t,n,o){var i,r,s;if(e.unmount&&e.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||I(i,null,n)),o||"function"==typeof t.type||(o=null!=(r=t.__e)),t.__e=t.__d=void 0,null!=(i=t.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(t){e.__e(t,n)}i.base=i.__P=null}if(i=t.__k)for(s=0;s<i.length;s++)i[s]&&T(i[s],n,o);null!=r&&d(r)}function j(t,e,n){return this.constructor(t,n)}function M(t,n,o){var i,a,c;e.__&&e.__(t,n),a=(i=o===r)?null:o&&o.__k||n.__k,t=u(p,null,[t]),c=[],D(n,(i?n:o||n).__k=t,a||s,s,void 0!==n.ownerSVGElement,o&&!i?[o]:a?null:n.childNodes.length?l.slice.call(n.childNodes):null,c,o||s,i),C(c,t)}e={__e:function(t,e){for(var n,o;e=e.__;)if((n=e.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(o=!0,n.setState(n.constructor.getDerivedStateFromError(t))),null!=n.componentDidCatch&&(o=!0,n.componentDidCatch(t)),o)return v(n.__E=n)}catch(e){t=e}throw t}},_.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof t&&(t=t(c({},n),this.props)),t&&c(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),v(this))},_.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),v(this))},_.prototype.render=p,n=[],o="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,g.__r=0,r=s;var O;class P extends _{constructor(t){super(t),this.maindiv={current:null}}componentDidMount(){this.updateJSON({},function(){this.maindiv.current&&(this.maindiv.current.react=this),this.postMountFunction()}.bind(this))}updateJSON(t,e){var n=this.setState.bind(this);try{$.getJSON("/"+this.objectType+"/read/"+this.props.objectID,(function(t){n(t,e)}))}catch(t){}}postMountFunction(){}setJSON(t,e){var n={};n[t]=e,this.setState(n,()=>updateValue(this.props.objectID,this.objectType,n))}addDeleteSelf(t=this.state.id,e=this.objectType,n){return u(V,{handleClick:deleteSelf.bind(this,t,e,()=>{this.props.updateParent({},n)})})}addInsertSibling(t=this.state.id,e=this.props.parentID,n=this.objectType,o){return u(W,{handleClick:insertSibling.bind(this,t,n,e,()=>{this.props.updateParent({},o)})})}makeSortable(t,e,n,o,i=!1,r=!1,s="",l=!1){t.sortable({containment:".workflow-container",axis:i,cursor:"move",grid:r,cursorAt:{top:20},connectWith:s,handle:l,tolerance:"pointer",start:(e,n)=>{$(o).addClass("dragging"),t.sortable("refresh");var i=$(t).sortable("instance");if(l){var r=$(i.currentItem).children(l);r=r[0],i.containment[0]-=r.offsetLeft,i.containment[2]+=i.currentItem[0].offsetWidth-r.offsetWidth-r.offsetLeft}i.containment[3]+=i.currentItem[0].offsetTop},remove:(t,e)=>{var o=e.item[0].id;this.childRemoved.bind(this)(n,parseInt(o))},receive:(t,o)=>{var i=o.item[0].id,r=$(o.item[0]).index();o.item[0].classList.contains("node-bar-sortable")?this.newChild.bind(this)(n,e,r,o):this.childAdded.bind(this)(n,parseInt(i),r)},stop:(t,i)=>{var r=i.item[0].id,s=$(i.item[0]).index(),l=parseInt(i.item[0].parentElement.id);l&&l!=e||this.childAdded.bind(this)(n,parseInt(r),s),$(o).removeClass("dragging"),$("#container").animate({scrollTop:$(i.item[0]).offset().top-200},20);var a=Math.round((i.position.left-i.originalPosition.left)/200),c=-1;if("nodestrategy"==n&&a){var d=i.item.children(".node"),u=d[0].react.state.columnworkflow;try{(c=O[O.indexOf(u)+a])&&d[0].react.setState({columnworkflow:c})}catch(t){console.log("could not change column")}}insertedAt(r,n,e,s,l,c,()=>$(o).trigger(n+"-reordered"))}})}childRemoved(t,e){try{var n=this.state[t+"_set"];n.indexOf(e)>=0&&n.splice(n.indexOf(e),1)}catch(t){}}childAdded(t,e,n){try{var o=this.state[t+"_set"];o.indexOf(e)>=0&&o.splice(o.indexOf(e),1),o.splice(n,0,e)}catch(t){}}newChild(t,e,n,o){"nodestrategy"==t&&newNode(e,n,o.item[0].sortableData.column,this.updateJSON.bind(this)),o.item.remove()}}function U(t){return u("p",null,t.text)}class A extends _{constructor(t){super(t),this.updateText=this.updateText.bind(this)}render(){var t=this.props.text;return null!=this.props.text&&""!=this.props.text||null==this.props.defaultText||(t=this.props.defaultText),this.text=t,u("input",{value:t,onBlur:this.updateText})}updateText(t){var e=t.target.value;e!=this.text&&(""==e&&(e=null),this.props.textUpdated(t.target.value))}}class V extends _{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"delete-self-button",onClick:this.handleClick},"x")}handleClick(t){this.props.handleClick(t)}}class W extends _{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return u("button",{class:"insert-sibling-button",onClick:this.handleClick},"+")}handleClick(t){this.props.handleClick(t)}}function J(t,e){for(var n=[],o=0;o<t.length;o++)n.push(t[o]+e[o]);return n}function E(t,e){for(var n=[],o=0;o<t.length;o++)n.push(t[o]-e[o]);return n}function F(t,e){return(t%e+e)%e}class L extends P{constructor(t){super(t),this.objectType="nodelink"}checkValid(t,e,n){console.log("checking whether valid"),console.log(t),console.log(e),console.log(n);var o=J(e,n);return console.log(Math.sign(t[0]*o[0])>=0&&Math.sign(t[1]*o[1])>=0),Math.sign(t[0]*o[0])>=0&&Math.sign(t[1]*o[1])>=0}getDirection(t,e){console.log("Getting the direction");var n=Math.sign(t[0]*e[1]-t[1]*e[0]);return console.log(t),console.log(e),console.log("dir = "+n),0==n?1:n}walkAround(){for(var t=!1,e=0,n=!1,o=0,i=source_port;i<source_port+4;i++)source_points.push([w1/2*(-1)**Math.floor(i/2),h1/2*(-1)**Math.floor((i+3)/2)]);for(i=target_port;i<target_port+4;i++)target_points.push([w2/2*(-1)**Math.floor(i/2),h2/2*(-1)**Math.floor((i+3)/2)]);console.log(source_points),console.log(target_points);var r=[target_points[0]],s=[source_points[0]],l=0;do{if(10==++l)break;if(t=this.checkValid(source_points[e],target_points[o],d1),n=this.checkValid(target_points[o],source_points[e],d2),t){if(!n){console.log("target has not been found. Getting the direction."),o=F(o+this.getDirection(target_points[o],J(source_points[e],d2)),5),console.log(o);a=target_points[o];r.push([a[0]+10*Math.sign(a[0]),a[1]+10*Math.sign(a[1])])}}else{console.log("source has not been found. Getting the direction."),e=F(e+this.getDirection(source_points[e],J(target_points[o],d1)),5),console.log(e);var a=source_points[e];s.push([a[0]+10*Math.sign(a[0]),a[1]+10*Math.sign(a[1])])}}while(!t||!n)}getPath(t,e,n,o,i){for(var r="M",s=0;s<t.length;s++){s>0&&(r+=" L");var l=J(o,t[s]);r+=parseInt(l[0]-n.left)+" "+parseInt(l[1]-n.top)}for(s=e.length-1;s>=0;s--){r+=" L";l=J(i,e[s]);r+=parseInt(l[0]-n.left)+" "+parseInt(l[1]-n.top)}return r}rerender(){console.log("in rerender function"),console.log("context is:"),console.log(this),this.forceUpdate()}render(){if(console.log("rendering link"),this.state.id){const r=2,s=0;var t=$("#"+this.state.source_node+".node"),e=$("#"+this.state.target_node+".node"),n=$(".workflow-canvas").offset(),o=t.offset();o.width=t.width(),o.height=t.height();var i=e.offset();i.width=e.width(),i.height=e.height();const l=o.width,a=o.height,c=i.width,d=i.height,h=[o.left+l/2,o.top+a/2],p=[i.left+c/2,i.top+d/2],_=(E(p,h),E(h,p),[[l/2*(r%2)*(-1)**Math.floor(r/2),a/2*((r+1)%2)*(-1)**Math.floor((r+2)/2)]]),f=[[l/2*(s%2)*(-1)**Math.floor(s/2),a/2*((s+1)%2)*(-1)**Math.floor((s+2)/2)]];return u("svg",{class:"dummysvg"},u("path",{stroke:"red","stroke-width":"3",d:this.getPath(_,f,n,h,p),ref:this.maindiv}))}}postMountFunction(){$("#"+this.state.target_node+".node").on("node-rendered",function(t,e){return function(n){let o=this.lastCall;this.lastCall=Date.now(),o&&this.lastCall-o<=e&&clearTimeout(this.lastCallTimer),console.log("in debounce"),this.lastCallTimer=setTimeout(()=>t(n),e)}}(this.rerender.bind(this)))}componentDidUpdate(){this.maindiv.current&&$(".workflow-canvas").append(this.maindiv.current)}}class R extends P{constructor(t){super(t),this.objectType="node"}render(){if(this.state.id){var t=this.state.outgoing_links.map(t=>u(L,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{class:"node column-"+this.state.columnworkflow,id:this.state.id,ref:this.maindiv},u(A,{text:this.state.title,defaultText:"New Node",textUpdated:this.setJSON.bind(this,"title")}),u(A,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),t)}}componentDidUpdate(){this.maindiv.current&&$(this.maindiv.current).trigger("node-rendered")}}class B extends P{constructor(t){super(t),this.objectType="nodestrategy"}render(){if(this.state.id)return u("div",{class:"node-strategy",id:this.state.id,ref:this.maindiv},u(R,{objectID:this.state.node}))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).on("nodestrategy-reordered",this.updateRank.bind(this))}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}}class G extends P{constructor(t){super(t),this.objectType="strategy"}render(){if(this.state.id){var t=this.state.nodestrategy_set.map(t=>u(B,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{class:"strategy"},u(A,{text:this.state.title,defaultText:this.state.strategy_type_display+" "+(this.props.rank+1),textUpdated:this.setJSON.bind(this,"title")}),u(A,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newNode(this.state.id,-1,O[O.length-1],this.updateJSON.bind(this))},"Add A Node"),u("div",{class:"node-block",id:this.props.objectID+"-node-block",ref:this.maindiv},t))}}postMountFunction(){this.makeSortable($(this.maindiv.current),this.props.objectID,"nodestrategy",".node-strategy",!1,[200,1],".node-block",".node")}}class H extends P{constructor(t){super(t),this.objectType="column"}render(){if(this.state.id){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"column"},t)}}}class z extends P{constructor(t){super(t),this.objectType="columnworkflow",$("<style>").prop("type","text/css").prop("id","column-"+this.props.objectID+"-CSS").appendTo("head")}render(){return this.state.id?(this.updateCSS(),u("div",{class:"column-workflow column-"+this.state.id,id:this.state.id,ref:this.maindiv},u(H,{objectID:this.state.column}),this.addDeleteSelf(this.state.column,"column",()=>$(".column-workflow").trigger("columnworkflow-reordered")))):u("div",{class:"column-workflow column-"+this.state.id})}postMountFunction(){this.maindiv.current&&($(".column-workflow").trigger("columnworkflow-reordered"),$(this.maindiv.current).on("columnworkflow-reordered",this.updateRank.bind(this)))}updateCSS(){$("#column-"+this.props.objectID+"-CSS").html(".column-"+this.props.objectID+"{left:"+this.calcDistance()+"px}")}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}calcDistance(){return 200*this.state.rank}}class q extends P{constructor(t){super(t),this.objectType="strategyworkflow"}render(){if(this.state.id)return u("div",{class:"strategy-workflow",id:this.state.id,ref:this.maindiv},u(G,{objectID:this.state.strategy,rank:this.state.rank}),this.addDeleteSelf(this.state.strategy,"strategy",()=>$(".strategy-workflow").trigger("strategyworkflow-reordered")),this.addInsertSibling(this.state.id,this.props.parentID,"strategyworkflow"))}postMountFunction(){this.maindiv.current&&($(".strategy-workflow").trigger("strategyworkflow-reordered"),$(this.maindiv.current).on("strategyworkflow-reordered",this.updateRank.bind(this)))}updateRank(){var t=$(this.maindiv.current).index();this.state.rank!=t&&this.setState({rank:t})}}class K extends P{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>u(z,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)})),e=this.state.strategyworkflow_set.map(t=>u(q,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return u("div",{id:"workflow-wrapper",class:"workflow-wrapper"},u("div",{class:"workflow-container"},u(A,{text:this.state.title,textUpdated:this.setJSON.bind(this,"title")}),u(U,{text:"Created by "+this.state.author}),u(A,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),u("button",{onClick:()=>newColumn(this.state.id,0,this.updateJSON.bind(this))},"Add A Column"),u("div",{class:"column-row"},t),u("div",{class:"strategy-block"},e),u("svg",{class:"workflow-canvas",width:"100%",height:"100%"})))}}postMountFunction(){this.makeSortable($(".strategy-block"),this.props.objectID,"strategyworkflow",".strategy-workflow","y"),this.makeSortable($(".column-row"),this.props.objectID,"columnworkflow",".column-workflow","x")}componentDidUpdate(){this.state&&(O=this.state.columnworkflow_set)}}class Q extends P{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>u(X,{key:t,objectID:t})),e=this.state.strategyworkflow_set.map(t=>u(Z,{key:t,objectID:t}));return u("div",{id:"node-bar-workflow",class:"node-bar-workflow",ref:this.maindiv},u("div",{class:"node-bar-column-block"},t),u("div",{class:"node-bar-strategy-block"},e))}}postMountFunction(){$(this.maindiv.current.parentElement).resizable({containment:"body"})}}class X extends P{constructor(t){super(t),this.objectType="columnworkflow"}render(){if(this.state.id)return u("div",{class:"node-bar-column-workflow",ref:this.maindiv},u(Y,{objectID:this.state.column}))}postMountFunction(){this.maindiv.current&&$(this.maindiv.current).sortable({connectWith:".node-block",helper:(t,e)=>(this.maindiv.current.copyHelper=e.clone().insertAfter(e),e.clone().appendTo(document.body)),containment:".workflow-container",start:(t,e)=>{e.item[0].sortableData={column:this.state.column}},stop:(t,e)=>{e.item[0].parentElement&&e.item[0].parentElement.classList.contains("node-bar-column-workflow")&&e.item.remove()}})}}class Y extends P{constructor(t){super(t),this.objectType="column"}render(){if(this.state){var t=this.state.title;return t||(t=this.state.column_type_display),u("div",{class:"node-bar-column node-bar-sortable"},t)}}}class Z extends P{constructor(t){super(t),this.objectType="strategyworkflow"}render(){}}return t.ClickEditText=A,t.ColumnView=H,t.ColumnWorkflowView=z,t.ComponentJSON=P,t.DeleteSelfButton=V,t.InsertSiblingButton=W,t.NodeBarColumnView=Y,t.NodeBarColumnWorkflowView=X,t.NodeBarStrategyWorkflowView=Z,t.NodeBarWorkflowView=Q,t.NodeLinkView=L,t.NodeStrategyView=B,t.NodeView=R,t.StrategyView=G,t.StrategyWorkflowView=q,t.Text=U,t.WorkflowView=K,t.renderNodeBar=function(t,e){M(u(Q,{objectID:t.id,type:t.type}),e)},t.renderWorkflowView=function(t,e){M(u(K,{objectID:t.id,type:t.type}),e)},t}({});
