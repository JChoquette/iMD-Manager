var workflow=function(t){"use strict";var e,n,r,s,o,i={},l=[],_=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function u(t,e){for(var n in e)t[n]=e[n];return t}function a(t){var e=t.parentNode;e&&e.removeChild(t)}function c(t,e,n){var r,s,o,i=arguments,l={};for(o in e)"key"==o?r=e[o]:"ref"==o?s=e[o]:l[o]=e[o];if(arguments.length>3)for(n=[n],o=3;o<arguments.length;o++)n.push(i[o]);if(null!=n&&(l.children=n),"function"==typeof t&&null!=t.defaultProps)for(o in t.defaultProps)void 0===l[o]&&(l[o]=t.defaultProps[o]);return d(t,l,r,s,null)}function d(t,n,r,s,o){var i={type:t,props:n,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:o};return null==o&&(i.__v=i),null!=e.vnode&&e.vnode(i),i}function p(t){return t.children}function h(t,e){this.props=t,this.context=e}function f(t,e){if(null==e)return t.__?f(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?f(t):null}function y(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return y(t)}}function v(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!g.__r++||s!==e.debounceRendering)&&((s=e.debounceRendering)||r)(g)}function g(){for(var t;g.__r=n.length;)t=n.sort((function(t,e){return t.__v.__b-e.__v.__b})),n=[],t.some((function(t){var e,n,r,s,o,i,l;t.__d&&(i=(o=(e=t).__v).__e,(l=e.__P)&&(n=[],(r=u({},o)).__v=r,s=C(l,o,r,e.__n,void 0!==l.ownerSVGElement,null,n,null==i?f(o):i),N(n,o),s!=i&&y(o)))}))}function k(t,e,n,r,s,o,_,u,c,h){var y,v,g,k,b,w,x,S=r&&r.__k||l,N=S.length;for(c==i&&(c=null!=_?_[0]:N?f(r,0):null),n.__k=[],y=0;y<e.length;y++)if(null!=(k=n.__k[y]=null==(k=e[y])||"boolean"==typeof k?null:"string"==typeof k||"number"==typeof k?d(null,k,null,null,k):Array.isArray(k)?d(p,{children:k},null,null,null):null!=k.__e||null!=k.__c?d(k.type,k.props,k.key,null,k.__v):k)){if(k.__=n,k.__b=n.__b+1,null===(g=S[y])||g&&k.key==g.key&&k.type===g.type)S[y]=void 0;else for(v=0;v<N;v++){if((g=S[v])&&k.key==g.key&&k.type===g.type){S[v]=void 0;break}g=null}b=C(t,k,g=g||i,s,o,_,u,c,h),(v=k.ref)&&g.ref!=v&&(x||(x=[]),g.ref&&x.push(g.ref,null,k),x.push(v,k.__c||b,k)),null!=b?(null==w&&(w=b),c=m(t,k,g,S,_,b,c),h||"option"!=n.type?"function"==typeof n.type&&(n.__d=c):t.value=""):c&&g.__e==c&&c.parentNode!=t&&(c=f(g))}if(n.__e=w,null!=_&&"function"!=typeof n.type)for(y=_.length;y--;)null!=_[y]&&a(_[y]);for(y=N;y--;)null!=S[y]&&j(S[y],S[y]);if(x)for(y=0;y<x.length;y++)T(x[y],x[++y],x[++y])}function m(t,e,n,r,s,o,i){var l,_,u;if(void 0!==e.__d)l=e.__d,e.__d=void 0;else if(s==n||o!=i||null==o.parentNode)t:if(null==i||i.parentNode!==t)t.appendChild(o),l=null;else{for(_=i,u=0;(_=_.nextSibling)&&u<r.length;u+=2)if(_==o)break t;t.insertBefore(o,i),l=i}return void 0!==l?l:o.nextSibling}function b(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||_.test(e)?n:n+"px"}function w(t,e,n,r,s){var o,i;if(s&&"className"==e&&(e="class"),"style"===e)if("string"==typeof n)t.style=n;else{if("string"==typeof r&&(t.style=r=""),r)for(e in r)n&&e in n||b(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||b(t.style,e,n[e])}else"o"===e[0]&&"n"===e[1]?(o=e!==(e=e.replace(/Capture$/,"")),(i=e.toLowerCase())in t&&(e=i),e=e.slice(2),t.l||(t.l={}),t.l[e]=n,n?r||t.addEventListener(e,x,o):t.removeEventListener(e,x,o)):"list"!==e&&"tagName"!==e&&"form"!==e&&"type"!==e&&"size"!==e&&"download"!==e&&"href"!==e&&!s&&e in t?t[e]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==e&&(e!==(e=e.replace(/xlink:?/,""))?null==n||!1===n?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(e)?t.removeAttribute(e):t.setAttribute(e,n))}function x(t){this.l[t.type](e.event?e.event(t):t)}function S(t,e,n){var r,s;for(r=0;r<t.__k.length;r++)(s=t.__k[r])&&(s.__=t,s.__e&&("function"==typeof s.type&&s.__k.length>1&&S(s,e,n),e=m(n,s,s,t.__k,null,s.__e,e),"function"==typeof t.type&&(t.__d=e)))}function C(t,n,r,s,o,i,l,_,a){var c,d,f,y,v,g,m,b,w,x,C,N=n.type;if(void 0!==n.constructor)return null;(c=e.__b)&&c(n);try{t:if("function"==typeof N){if(b=n.props,w=(c=N.contextType)&&s[c.__c],x=c?w?w.props.value:c.__:s,r.__c?m=(d=n.__c=r.__c).__=d.__E:("prototype"in N&&N.prototype.render?n.__c=d=new N(b,x):(n.__c=d=new h(b,x),d.constructor=N,d.render=I),w&&w.sub(d),d.props=b,d.state||(d.state={}),d.context=x,d.__n=s,f=d.__d=!0,d.__h=[]),null==d.__s&&(d.__s=d.state),null!=N.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=u({},d.__s)),u(d.__s,N.getDerivedStateFromProps(b,d.__s))),y=d.props,v=d.state,f)null==N.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==N.getDerivedStateFromProps&&b!==y&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(b,x),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(b,d.__s,x)||n.__v===r.__v){d.props=b,d.state=d.__s,n.__v!==r.__v&&(d.__d=!1),d.__v=n,n.__e=r.__e,n.__k=r.__k,d.__h.length&&l.push(d),S(n,_,t);break t}null!=d.componentWillUpdate&&d.componentWillUpdate(b,d.__s,x),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(y,v,g)}))}d.context=x,d.props=b,d.state=d.__s,(c=e.__r)&&c(n),d.__d=!1,d.__v=n,d.__P=t,c=d.render(d.props,d.state,d.context),d.state=d.__s,null!=d.getChildContext&&(s=u(u({},s),d.getChildContext())),f||null==d.getSnapshotBeforeUpdate||(g=d.getSnapshotBeforeUpdate(y,v)),C=null!=c&&c.type==p&&null==c.key?c.props.children:c,k(t,Array.isArray(C)?C:[C],n,r,s,o,i,l,_,a),d.base=n.__e,d.__h.length&&l.push(d),m&&(d.__E=d.__=null),d.__e=!1}else null==i&&n.__v===r.__v?(n.__k=r.__k,n.__e=r.__e):n.__e=D(r.__e,n,r,s,o,i,l,a);(c=e.diffed)&&c(n)}catch(t){n.__v=null,e.__e(t,n,r)}return n.__e}function N(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(t){t.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function D(t,e,n,r,s,o,_,u){var a,c,d,p,h,f=n.props,y=e.props;if(s="svg"===e.type||s,null!=o)for(a=0;a<o.length;a++)if(null!=(c=o[a])&&((null===e.type?3===c.nodeType:c.localName===e.type)||t==c)){t=c,o[a]=null;break}if(null==t){if(null===e.type)return document.createTextNode(y);t=s?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type,y.is&&{is:y.is}),o=null,u=!1}if(null===e.type)f!==y&&t.data!==y&&(t.data=y);else{if(null!=o&&(o=l.slice.call(t.childNodes)),d=(f=n.props||i).dangerouslySetInnerHTML,p=y.dangerouslySetInnerHTML,!u){if(null!=o)for(f={},h=0;h<t.attributes.length;h++)f[t.attributes[h].name]=t.attributes[h].value;(p||d)&&(p&&d&&p.__html==d.__html||(t.innerHTML=p&&p.__html||""))}(function(t,e,n,r,s){var o;for(o in n)"children"===o||"key"===o||o in e||w(t,o,null,n[o],r);for(o in e)s&&"function"!=typeof e[o]||"children"===o||"key"===o||"value"===o||"checked"===o||n[o]===e[o]||w(t,o,e[o],n[o],r)})(t,y,f,s,u),p?e.__k=[]:(a=e.props.children,k(t,Array.isArray(a)?a:[a],e,n,r,"foreignObject"!==e.type&&s,o,_,i,u)),u||("value"in y&&void 0!==(a=y.value)&&a!==t.value&&w(t,"value",a,f.value,!1),"checked"in y&&void 0!==(a=y.checked)&&a!==t.checked&&w(t,"checked",a,f.checked,!1))}return t}function T(t,n,r){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,r)}}function j(t,n,r){var s,o,i;if(e.unmount&&e.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||T(s,null,n)),r||"function"==typeof t.type||(r=null!=(o=t.__e)),t.__e=t.__d=void 0,null!=(s=t.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(t){e.__e(t,n)}s.base=s.__P=null}if(s=t.__k)for(i=0;i<s.length;i++)s[i]&&j(s[i],n,r);null!=o&&a(o)}function I(t,e,n){return this.constructor(t,n)}e={__e:function(t,e){for(var n,r;e=e.__;)if((n=e.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(r=!0,n.setState(n.constructor.getDerivedStateFromError(t))),null!=n.componentDidCatch&&(r=!0,n.componentDidCatch(t)),r)return v(n.__E=n)}catch(e){t=e}throw t}},h.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=u({},this.state),"function"==typeof t&&(t=t(u({},n),this.props)),t&&u(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),v(this))},h.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),v(this))},h.prototype.render=p,n=[],r="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,g.__r=0,o=i;class P extends h{constructor(t){super(t),console.log(t)}componentDidMount(){this.updateJSON()}updateJSON(){console.log("fetching json for "+this.props.objectID);var t=this.setState.bind(this);$.getJSON("/"+this.objectType+"/read/"+this.props.objectID,(function(e){console.log(e),t(e)}))}setJSON(t,e){var n={};n[t]=e,this.setState(n,()=>updateValue(this.props.objectID,this.objectType,this.state))}addDeleteSelf(t=this.state.id,e=this.objectType){return c(J,{handleClick:deleteSelf.bind(this,t,e,this.props.updateParent)})}addInsertSibling(t=this.state.id,e=this.props.parentID,n=this.objectType){return c(A,{handleClick:insertSibling.bind(this,t,n,e,this.props.updateParent)})}}function U(t){return c("p",null,t.text)}class O extends h{constructor(t){super(t),this.updateText=this.updateText.bind(this)}render(){var t=this.props.text;return null!=this.props.text&&""!=this.props.text||null==this.props.defaultText||(t=this.props.defaultText),this.text=t,c("input",{value:t,onBlur:this.updateText})}updateText(t){var e=t.target.value;e!=this.text&&(""==e&&(e=null),this.props.textUpdated(t.target.value))}}class J extends h{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return c("button",{class:"delete-self-button",onClick:this.handleClick},"x")}handleClick(t){this.props.handleClick(t)}}class A extends h{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}render(){return c("button",{class:"insert-sibling-button",onClick:this.handleClick},"+")}handleClick(t){this.props.handleClick(t)}}class E extends P{constructor(t){super(t),this.objectType="node"}render(){if(this.state.id)return c("div",{class:"node"},c(O,{text:this.state.title,defaultText:"New Node",textUpdated:this.setJSON.bind(this,"title")}),c(O,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}))}}class W extends P{constructor(t){super(t),this.objectType="nodestrategy"}render(){if(this.state.id)return c("div",null,' class="node-strategy"',c(E,{objectID:this.state.node}))}}class V extends P{constructor(t){super(t),this.objectType="strategy"}render(){if(this.state.id){var t=this.state.nodestrategy_set.map(t=>c(W,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return c("div",{class:"strategy"},c(O,{text:this.state.title,defaultText:this.state.strategy_type_display+" "+(this.props.rank+1),textUpdated:this.setJSON.bind(this,"title")}),c(O,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),c("div",null,t))}}}class L extends P{constructor(t){super(t),this.objectType="column"}render(){if(this.state.id){var t=this.state.title;return t||(t=this.state.column_type_display),c("div",{class:"column"},t)}}}class M extends P{constructor(t){super(t),this.objectType="columnworkflow"}render(){if(this.state.id)return c("div",{class:"column-workflow"},c(L,{objectID:this.state.column}),this.addDeleteSelf(this.state.column,"column"))}}class B extends P{constructor(t){super(t),this.objectType="strategyworkflow",this.className="strategy-workflow",this.maindiv={current:null}}render(){if(this.state.id)return c("div",{class:"strategy-workflow",id:this.state.id,ref:this.maindiv},c(V,{objectID:this.state.strategy,rank:this.state.rank}),this.addDeleteSelf(this.state.strategy,"strategy"),this.addInsertSibling())}componentDidUpdate(){this.maindiv.current&&$(this.maindiv.current).on("refresh-strategy-workflows",this.updateJSON.bind(this))}}class F extends P{constructor(t){super(t),this.objectType=t.type}render(){if(this.state.id){var t=this.state.columnworkflow_set.map(t=>c(M,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)})),e=this.state.strategyworkflow_set.map(t=>c(B,{key:t,objectID:t,parentID:this.state.id,updateParent:this.updateJSON.bind(this)}));return c("div",{id:"workflow-wrapper",class:"workflow-wrapper"},c("div",{class:"workflow-container"},c(O,{text:this.state.title,textUpdated:this.setJSON.bind(this,"title")}),c(U,{text:"Created by "+this.state.author}),c(O,{text:this.state.description,textUpdated:this.setJSON.bind(this,"description")}),c("button",{onClick:()=>newColumn(this.state.id,0,this.updateJSON.bind(this))},"Add A Column"),c("div",{class:"column-row"},t),c("div",{class:"strategy-block"},e)))}}componentDidUpdate(){var t=$(".strategy-block"),e=this.props.objectID;t.sortable({revert:100,containment:".workflow-container",axis:"y",cursor:"move",cursorAt:{left:10,top:50},start:()=>{$(".strategy-workflow").addClass("dragging"),t.sortable("refresh")},stop:(t,n)=>{$(".strategy-workflow").removeClass("dragging"),$("#container").animate({scrollTop:$(n.item[0]).offset().top-200},20),insertedAt(n.item[0].id,"strategyworkflow",e,$(n.item[0]).index(),()=>$(".strategy-workflow").trigger("refresh-strategy-workflows"))}})}}return t.ClickEditText=O,t.ColumnView=L,t.ColumnWorkflowView=M,t.ComponentJSON=P,t.DeleteSelfButton=J,t.InsertSiblingButton=A,t.NodeStrategyView=W,t.NodeView=E,t.StrategyView=V,t.StrategyWorkflowView=B,t.Text=U,t.WorkflowView=F,t.renderWorkflowView=function(t,n){console.log(t),function(t,n,r){var s,_,u;e.__&&e.__(t,n),_=(s=r===o)?null:r&&r.__k||n.__k,t=c(p,null,[t]),u=[],C(n,(s?n:r||n).__k=t,_||i,i,void 0!==n.ownerSVGElement,r&&!s?[r]:_?null:n.childNodes.length?l.slice.call(n.childNodes):null,u,r||i,s),N(u,t)}(c(F,{objectID:t.id,type:t.type}),n)},t}({});
